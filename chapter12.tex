%Chapter XII----------------------------------------------------------------------
\noindent{\LARGE \bfseries XII \\ \\ An Algebraic Characterization\\of Elementary Equivalence}
\\
\\
\\
%Section XII.1--------------------------------------------------------------------
{\large \S1. Finite and Partial Isomorphisms}
\begin{enumerate}[1.]
%
\item \textbf{Note on Definition 1.1.} If the map $\pi : A \to B$ is an isomorphism of $\struct{A}$ onto $\struct{B}$, then it is a partial isomorphism from $\struct{A}$ to $\struct{B}$.
%
\item \textbf{Note on Examples and Comments 1.2.} For part (c), we finish the incomplete \emph{proof} in text. Assuming ($\ast$), then for $i, j < r$\smallskip\\
\begin{quoteno}{(3)}
$a_i = a_j$ \quad iff \quad $b_i = b_j$,
\end{quoteno}\smallskip\\
since $p$ is well-defined and injective; for $n$-ary $P \in S$ and $\seq[1]{i}{n} < r$\smallskip\\
\begin{quoteno}{(4)}
$P^\struct{A} \enum[i_1]{a}{i_n}$ \ \ \ iff \ \ \ $P^\struct{B} \enum[i_1]{b}{i_n}$,
\end{quoteno}\smallskip\\
since $p$ is homomorphic.\bigskip\\
From (1) and (3), it follows that for $i, j < r$,\\
\centerline{$\struct{A} \models v_i \equal v_j [\seq{a}{r - 1}]$ \quad iff \quad $\struct{B} \models v_i \equal v_j [\seq{b}{r - 1}]$.}\\
Also, (2) and (4) together yield: for $n$-ary $P \in S$ and $\seq[1]{i}{n} < r$,\\
\centerline{$\struct{A} \models P \enum[i_1]{v}{i_n} [\seq{a}{r - 1}]$ \quad iff \quad $\struct{B} \models P \enum[i_1]{v}{i_n} [\seq{b}{r - 1}]$.}\\
Thus, we obtain ($\ast\ast$).\qed\\
\ \\
For part (d), a further counterexample is given here: Let $S_0 \defas \setenum{c, d}$ be a symbol set consisting only of constants. Consider the two $S_0$-structures $\struct{A} = \tuple{X, \intpted{c}{A}, \intpted{d}{A}}$ and $\struct{B} = \tuple{X, \intpted{c}{B}, \intpted{d}{B}}$, where $X \defas \setenum{0, 1, 2}$, $\intpted{c}{A} = \intpted{d}{A} = \intpted{c}{B} = 0$ and $\intpted{d}{B} = 1$. Then $p$ with $\dom{p} = \setenum{2}$ and $p(2) = 2$ is a partial isomorphism from $\struct{A}$ to $\struct{B}$, but $\struct{A} \models c \equal d [2]$ and not $\struct{B} \models c \equal d [2]$.\\
\ \\
Notice that the definition of partial isomorphisms is different in other texts like \cite{Heinz_Dieter_Ebbinghaus_and_Jorg_Flum}, where the constants are required to be in the domain of a partial isomorphism. In that setting, the equivalence between ($\ast$) and ($\ast\ast$) still holds and the above counterexample is not applicable.\\
\ \\
Below we investigate more about the relation between ($\ast$) and ($\ast\ast$). Let $S$ contain function symbols or constant symbols, and denote $A^\prime \colonequals \{ \seq{a}{r - 1} \}$ and $B^\prime \colonequals \{ \seq{b}{r - 1} \}$.\\
\ \\
It is still true that ($\ast\ast$) implies ($\ast$): Based on the proof showing ($\ast\ast$) implies ($\ast$) given in text, we only have to consider two more conditions, namely 1.1(b)(2) and (3). For condition 1.1(b)(2), let $f$ be an $n$-ary, and apply ($\ast\ast$) to all formulas $\psi = f \enum[i_1]{v}{i_n} \equal v_{i_{n + 1}}$ with $\seq[1]{i}{n + 1} < r$. For condition 1.1(b)(3), let $c$ be a constant symbol, and apply ($\ast\ast$) to all formulas $\psi = c \equal v_i$ with $i < r$.\\
\ \\
Moreover, if $A^\prime$ and $B^\prime$ are $S$-closed in $\struct{A}$ and in $\struct{B}$, respectively, then the equivalence of ($\ast$) and ($\ast\ast$) still holds: The direction from ($\ast\ast$) to ($\ast$) immediately follows from the above argument. So we only prove the inverse direction: Let $\struct{A}^\prime \colonequals [A^\prime]^\struct{A}$ and $\struct{B}^\prime \colonequals [B^\prime]^\struct{B}$, i.e.\ the structures generated by $A^\prime$ in $\struct{A}$ and by $B^\prime$ in $\struct{B}$, respectively (cf.\ the discussion after III.5.4). Assuming ($\ast$), then by definition of $p$, $p$ turns out to be an isomorphism of $\struct{A}^\prime$ onto $\struct{B}^\prime$ (cf.\ III.5.1). To show ($\ast\ast$) holds, for atomic formulas $\psi \in L^S_r$ we argue as follows:\smallskip\\
\begin{tabular}{lll}
\   & $\struct{A} \models \psi [\seq{a}{r - 1}]$ & \ \cr
iff & $\struct{A}^\prime \models \psi [\seq{a}{r - 1}]$ & (by Lemma III.5.5) \cr
iff & $\struct{B}^\prime \models \psi [\seqp{p(a_0)}{p(a_{r - 1})}]$ & (by Corollary III.5.3) \cr
iff & $\struct{B}^\prime \models \psi [\seq{b}{r - 1}]$ & (by definition of $p$) \cr
iff & $\struct{B} \models \psi [\seq{b}{r - 1}]$ & (by Lemma III.5.5).
\end{tabular}\\
\ \\
Thus, in the situation that $S$ contains function or constant symbols, we see from the above argument and the counterexample given in text that, in general, the equivalence in part (c) is not true since $\dom{p}$ or $\rg{p}$ may not be $S$-closed (in $\struct{A}$ and in $\struct{B}$, respectively).\\
\ \\
In summary, the reason that the equivalence may not hold for $p$ when there are constant or function symbols is that the terms involving these symbols may refer to elements outside of $\dom{p}$ that are ``hidden'' in an atomic formula, like $c \equal d$ or $v_0 + (v_0 + v_0) \equal v1$. (There are no hidden elements outside of $\dom{p}$ in an atomic formula if $S$ is relational.) Therefore, the equivalence also holds if we restrict the atomic formulas in ($\ast\ast$) to be \emph{term-reduced} (cf.\ Section VIII.1) even if $\dom{p}$ or $\rg{p}$ is not $S$-closed.\\
\ \\
Finally, in part (e) there is a typo: Both occurrences of $p_0$ in line 3 on page 246 should be replaced by those of $p$.
%
\item \textbf{Note on Lemma 1.5(d).} The situation stated in the hypothesis\\
\centerline{``$\struct{A} \partiso \struct{B}$, $A$ and $B$ are at most countable''}\\
can be split into two cases according to whether $A$ is finite:
\begin{enumerate}[(1)]
\item $A$ is finite, in addition to the (original) hypothesis: The new hypothesis is ``$\struct{A} \partiso \struct{B}$, $A$ is finite and $B$ at most countable.''
%%
\item $A$ is infinite, in addition to the (original) hypothesis: The new hypothesis is ``$\struct{A} \partiso \struct{B}$, $A$ is countable and $B$ at most countable.''
\end{enumerate}
In case (1), the conclusion $\struct{A} \iso \struct{B}$ immediately follows from parts (b) and (c) of this lemma. (And hence $B$ must be finite.)\\
\ \\
In case (2), let $I: \struct{A} \partiso \struct{B}$. Then, $B$ cannot be finite since, if it were, say $B = \{ b_1, \ldots, b_r \}$, repeated applications of the back-property to an arbitrary $p \in I$ to $b_1, \ldots, b_r$ would yield a partial isomorphism $q$ from $\struct{A}$ \emph{onto} $\struct{B}$, to which we cannot apply the forth-property! So, both $A$ and $B$ are countable. From here follows the proof given in text.
%
\item \textbf{Note on Example 1.8.} Recall that the Peano axiom system (cf.\ III.7.3(2)) is formalized by
\begin{enumerate}[(P1)]
\item $\forall x \neg \mbf{\sigma}x \equal 0$;
%%
\item $\forall x \forall y (\mbf{\sigma}x \equal \mbf{\sigma}y \rightarrow x \equal y)$;
%%
\item $\forall X ((X0 \land \forall x(Xx \rightarrow X \mbf{\sigma}x )) \rightarrow \forall y Xy)$,
\end{enumerate}
where (P3) is a second-order $\{ \mbf{\sigma}, 0 \}$-sentence. If we write
\begin{itemize}
\item (S0) \ for \ $\forall x (\neg x \equal 0 \liff \exists y \mbf{\sigma} y \equal x)$, and
%%
\item (S$m$) \ for \ $\forall x \neg\underbrace{\enump{\mbf{\sigma}}{\mbf{\sigma}}}_{\text{\mathmode{m}-times}} x \equal x$, where $m \geq 1$,
\end{itemize}
then $\Phi_\sigma = \{ \mbox{(P2)} \} \cup \setm{\mbox{(S\mathmode{n})}}{n \in \nat}$.\\
\ \\
Notice that:
\begin{enumerate}[(1)]
\item (P1) is a consequence of (S0).
%%
\item (S0) is a consequence of (P1) and (P3). (This can be verified by means of a derivation using the second rule given in IX.1.6 together with the one mentioned in \textbf{Note on 1.6} in Chapter IX.)
%%
\item For $m \geq 1$, (S$m$) is a consequence of (P1) - (P3). (This can be verified similarly.)
\end{enumerate}
One may attempt to replace (S0) in $\Phi_\sigma$ with (P1) to obtain an ``alternative'' and equivalent system of successor axioms; however, the structure $\struct{A} = \tuple{\nat, \mbf{\sigma}^A, 0}$, in which $\mbf{\sigma}^A (n) \colonequals n + 2$ for $n \in \nat$, shows that such a replacement results in a system of successor axioms not equivalent to $\Phi_\sigma$.\\
\ \\
There is a typo in line 12 from the bottom of page 248: ``$\pair{0^A}{0^B} \in I_n$'' should be replaced by ``$\{ \pair{0^A}{0^B} \} \in I_n$''.\\
\ \\
The distance function $d_n$ (or more precisely, the bound $2^n$) is so chosen that, in the situation where we obtain a $q \in I_n$ from a $p \in I_{n + 1}$ and an $a \in A$ for which ($\ast$) does not hold but however there is an $a_1 \in \dom{p}$ such that, say, $a = \underbrace{\enump{\mbf{\sigma}}{\mbf{\sigma}}}_\text{\mathmode{m}-times}(a_1)$ for some $m > 2^n$, if $a_2 \in A$ is between $a_1$ and $a$ (i.e.\ $a$ is ``reachable from'' $a_2$, which in turn is ``reachable from'' $a_1$, through $\mbf{\sigma}$) then $d_{n - 1}(a_1, a_2) = \infty$ or $d_{n - 1}(a_2, a) = \infty$, which is compatible with the method used in the proof.\\
\ \\
There is another typo in the second last line on page 248: ``every model $\Phi_\sigma$'' should be replaced by ``every model of $\Phi_\sigma$''.\\
\ \\
Finally, to see that every model $\struct{A}$ of $\Phi_\sigma$ is infinite, notice that $\mbf{\sigma}^A$ is injective but not surjective ($0^A \not\in \rg{\mbf{\sigma}^A}$!), so $A$ must be infinite (cf.\ the discussion in IX.1.3(6) in text).
%
\item \textbf{Solution to Exercise 1.9.} First note that an infinite $\emptyset$-structure is an infinite set, and vice versa. So, it suffices to show that, given two infinite sets $A$ and $B$, there is a nonempty set $I$ of partial isomorphisms from $A$ to $B$ such that $I : A \partiso B$.\\
\ \\
Let $I \colonequals \sett{p \in \partism{\struct{A}}{\struct{B}}}{\mathmode{\dom{p}} is finite}$. Then, $I \neq \emptyset$ since $\emptyset \in I$. Also, the forth- and the back-property trivially hold as there are infinite supplies of elements from $A$ and from $B$.
%
\item \textbf{Solution to Exercise 1.10.} (a) Consider the two dense orderings $\pair{\rat}{<}$ and $\pair{\real}{<}$. There can be no isomorphisms between them, although they are partially isomorphic (cf.\ Lemma 1.7 in text).\\
\ \\
Alternatively, we could also consider sets $\rat$ and $\real$, view them as $\emptyset$-structures and apply the result in Exercise 1.9.\\
\ \\
(b) Consider $S = \{ \mbf{\sigma}, 0 \}$ and let $\struct{A} = \tuple{A, \mbf{\sigma}^A, 0}$ with $A \colonequals \nat \cup \setm{\underline{m}}{m \in \zah}$, and
\begin{medcenter}
\begin{tabular}{llll}
$\mbf{\sigma}^A (n)$ & $\colonequals$ & $n + 1$ & for $n \in \nat$, \cr
$\mbf{\sigma}^A (\underline{m})$ & $\colonequals$ & $\underline{m + 1}$ & for $m \in \zah$.
\end{tabular}
\end{medcenter}
Both $\natstr_\sigma$ and $\struct{A}$ are countable; hence by 1.5(d) they are not partially isomorphic because they are not isomorphic. By 1.8, however, $\natstr_\sigma$ and $\struct{A}$ are finitely isomorphic since they are models of $\Phi_\sigma$.

As another example, consider the two orderings $\struct{Z}_1 = (\zah, <), \struct{Z}_2 = (\zah', <')$ where
\[
\zah' \defas \setenum{0, 1} \times \zah
\]
and for all $(b_1, z_1), (b_2, z_2) \in \zah'$,
\begin{center}
$(b_1, z_1) <' (b_2, z_2)$ \ \ iff \ \ ($b_1 < b_2$) or ($b_1 = b_2$ and $z_1 < z_2$).
\end{center}
Define the distance functions
\[
\begin{array}{l}
d : \zah \times \zah \to \nat, d(z_1, z_2) = \absval{z_1 - z_2} \cr
d' : \zah' \times \zah' \to \nat \union \setenum{\infty}, d'((b_1, z_1), (b_2, z_2)) =
\begin{cases}
\absval{z_1 - z_2} & \text{if \mathmode{b_1 = b_2}} \cr
\infty & \text{otherwise} \cr
\end{cases}\cr
\end{array}
\]
and their ``truncated versions'', for $n \in \nat$,
\[
\begin{array}{l}
d_n : \zah \times \zah \to \nat, d_n(z_1, z_2) =
\begin{cases}
d(z_1, z_2) & \text{if \mathmode{d(z_1, z_2) < 2^n}} \cr
\infty      & \text{otherwise} \cr
\end{cases}, \cr
d'_n : \zah' \times \zah' \to \nat, d'_m((b_1, z_1), (b_2, z_2)) =
\begin{cases}
d'((b_1, z_1), (b_2, z_2)) & \text{if \mathmode{d'((b_1, z_1), (b_2, z_2)) < 2^n}} \cr
\infty      & \text{otherwise} \cr
\end{cases}. \cr
\end{array}
\]
Then we have $\seqi{I_n}{n \in \nat} : \struct{Z}_1 \finiso \struct{Z}_2$ with
\[
I_n \defas \sett{p \in \partism{\struct{Z}_1}{\struct{Z}_2}}{\mathmode{\dom{p}} is finite and for all \mathmode{z, z' \in \dom{p}}, \mathmode{d_n(z, z') = d'_n(p(z), p(z')}}.
\]
But $\struct{Z}_1$ and $\struct{Z}_2$ are not partially isomorphic: For any partial isomorphism $p$ from $\struct{Z}_1$ to $\struct{Z}_2$, it can extended to a $p_1 \in \partism{\struct{Z}_1}{\struct{Z}_2}$ so that $(0, 0), (1, 0) \in \rg{p_1}$, say $p_1(n_1) = (0, 0), p_1(n_2) = (1, 0)$ for some $n_1, n_2 \in \zah$; $p_1$ cannot, however, be extended to any $p_2$ with $(0, 1), (0, 2), \ldots, (0, n_2 - n_1) \in \rg{p_2}$ such that $p_2 \in \partism{\struct{Z}_1}{\struct{Z}_2}$.
%
\item \textbf{Solution to Exercise 1.11.} Let $\struct{A} = \tuple{A, \intpted{\formal{\suc}}{A}, 0}$, where $A \defas \nat \union \setm{\underline{r}}{r \in \real}$ and
\begin{medcenter}
\begin{tabular}{llll}
$\intpted{\formal{\suc}}{A} (n)$ & $\defas$ & $n + 1$ & for $n \in \nat$, \cr
$\intpted{\formal{\suc}}{A} (\underline{r})$ & $\defas$ & $\underline{r + 1}$ & for $r \in \real$.
\end{tabular}
\end{medcenter}
It is easy to check that $\struct{A}$ is an uncountable model of $\Phi_\sigma$.
%
\item \textbf{Solution to Exercise 1.12.} Given two structures $\struct{A}$ and $\struct{B}$, if $I$ is a set for $\struct{A} \partemb \struct{B}$, then $(I)_{n \in \nat}$ is a sequence for $\struct{A} \finemb \struct{B}$. In other words,\smallskip\\
\begin{quoteno}{($\ast$)}
if \ $\struct{A} \partemb \struct{B}$ \ then \ $\struct{A} \finemb \struct{B}$.
\end{quoteno}\smallskip\\
This will turn out to be useful later.
\begin{enumerate}[(a)]
\item Let a symbol set $S$ be given, and let $\struct{A}$ and $\struct{B}$ be $S$-structures such that $(I_n)_{n \in \nat}$ is a sequence for $\struct{A} \finemb \struct{B}$. Furthermore, assume $A = \{\seq{a}{r}\}$.\\
\ \\
We pick an arbitrary $p \in I_{r + 1}$. Starting from $p$, and then by successively applying the forth-property to $\seq{a}{r}$, we obtain a map $q \in I_0$ with $\dom{q} = A$.\\
\ \\
We are done if we can show that $q$ is an isomorphism of $\struct{A}$ onto the substructure $[\rg{q}]^\struct{B}$ generated by $\rg{q}$ in $\struct{B}$ (cf.\ the discussion below III.5.4), for which it suffices to show $\rg{q}$ is $S$-closed: First, $\rg{q}$ consists of $r + 1$ elements and hence is not empty. Next, using 1.1(b)(2) and (3), respectively, we have:
\begin{enumerate}[(i)]
\item For $n$-ary $f \in S$ and for $\seq[1]{b}{n} \in \rg{q}$, $f^\struct{B} (\seq[1]{b}{n}) = q(f^\struct{A} (\seqp{q^{-1}(b_1)}{q^{-1}(b_n)})) \in \rg{q}$.
%%%
\item For $c \in S$, $c^\struct{B} = q(c^\struct{A}) \in \rg{q}$.
\end{enumerate}
%%
\item Let a symbol set $S$ be given, and let $\struct{A}$ and $\struct{B}$ be $S$-structures such that $I$ is a set for $\struct{A} \partemb \struct{B}$. If $A$ is finite, then from ($\ast$) and part (a) it immediately follows that $\struct{A}$ is embeddable in $\struct{B}$.\\
\ \\
So we consider the case in which $A$ is countable. Assume $A = \setm{a_n}{n \in \nat}$. We pick an arbitrary $p \in I$. Inductively, let $q_0 \colonequals p$ and for $n > 0$ define $q_n$ to be the map obtained by applying the forth-property to $q_{n - 1}$ and $a_{n - 1}$. The map $q \colonequals \bigcup_{n \in \nat} q_n$ is a partial isomorphism from $\struct{A}$ to $\struct{B}$ with $\dom{q} = A$.\\
\ \\
As in (a), we have that $\rg{q}$ is $S$-closed in $\struct{B}$, as can verified similarly. So, $q$ is an isomorphism from $\struct{A}$ onto the substructure $[\rg{q}]^\struct{B}$, hence $\struct{A}$ is embeddable in $\struct{B}$.
%%
\item Let $I$ be chosen as in Lemma 1.7 in text, and argue as in the proof there but leave out the back-property, which is not needed here (and may not even be available in case $\struct{A}$ is not dense).
\end{enumerate}
\end{enumerate}
%End of Section XII.1-------------------------------------------------------------
\
\\
\\
%Section XII.2--------------------------------------------------------------------
{\large \S2. Fra\"{i}ss\'{e}'s Theorem}
\begin{enumerate}[1.]
\item \textbf{Note on Fra\"{i}ss\'{e}'s Theorem 2.1.} In contrast, we have the following result which generalizes one direction of this theorem (and which also follows from this theorem!):\medskip\\
\emph{Let $S$ be a symbol set, and $\struct{A}$, $\struct{B}$ $S$-structures. Then we have: If $\struct{A} \finiso \struct{B}$ then $\struct{A} \equiv \struct{B}$.}
\begin{proof}
Assume that $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$. We show $\struct{A} \equiv \struct{B}$: For every $S$-sentence $\varphi$, there is a \emph{finite} $S_0 \subset S$ such that $\varphi$ is also an $S_0$-sentence, $(I_n)_{n \in \nat}: \reduct{\struct{A}}{S_0} \finiso \reduct{\struct{B}}{S_0}$ and hence $\reduct{\struct{A}}{S_0} \equiv \reduct{\struct{B}}{S_0}$ by Fra\"{i}ss\'{e}'s Theorem. Then $\struct{A} \models \varphi$\smallskip\\
\begin{tabular}[b]{lll}
iff & $\reduct{\struct{A}}{S_0} \models \varphi$ & (by the Coincidence Lemma) \cr
iff & $\reduct{\struct{B}}{S_0} \models \varphi$ & (since $\reduct{\struct{A}}{S_0} \equiv \reduct{\struct{B}}{S_0}$) \cr
iff & $\struct{B} \models \varphi$ & (by the Coincidence Lemma).
\end{tabular}
\end{proof}
%
\item \textbf{Note on Proposition 2.4.} There is a typo in part (b): $\thr{\nat, \suc}$ should be replaced by $\thr{\nat, \suc, 0}$.
%
\item \textbf{Solution to Exercise 2.5.} Let us denote $\Phi \colonequals \setm{\varphi_{\geq n}}{n \geq 2}$. Given $S = \emptyset$, any two models of $\consqn{\Phi}$ (i.e.\ any two infinite sets) are infinite $S$-structures, which, by Exercise 1.9, are partially isomorphic and hence (cf.\ 1.5(b)) finitely isomorphic, so they are elementarily equivalent by 2.1. Therefore, the theory $\consqn{\Phi}$ is complete (cf.\ 2.3) and is R-decidable since $\Phi$ is R-decidable (cf.\ X.6.5(a)).
%
\item \textbf{Solution to Exercise 2.6.} First, we show $\struct{A} \equiv \struct{B}$. As hinted in text, we have\\
\centerline{$\struct{A} \equiv \struct{B}$ \quad iff \quad for every finite $S_0 \subset S$, $\reduct{\struct{A}}{S_0} \finiso \reduct{\struct{B}}{S_0}$.}\\
So, it suffices to show for every finite $S_0 \subset S$,\smallskip\\
\begin{quoteno}{($\ast$)}
$\reduct{\struct{A}}{S_0} \iso \reduct{\struct{B}}{S_0}$
\end{quoteno}\smallskip\\
(from which it follows that $\reduct{\struct{A}}{S_0} \finiso \reduct{\struct{B}}{S_0}$ by Lemma 1.5).\\
\ \\
Let $S_0 \subset S$ be finite. If $S_0 = \emptyset$, then ($\ast$) trivially holds since both $A$ and $B$ are countable. If $S_0 \neq \emptyset$, then let
\[
n_0 \colonequals \max \setm{i \in \nat}{P_i \in S_0}.
\]
Choose $\pi : A \to B$ with
\[
\pi(n) \colonequals \begin{cases}
n      & \mbox{if \(n \leq n_0\)} \cr
\infty & \mbox{if \(n = n_0 + 1\)} \cr
n - 1  & \mbox{otherwise}
\end{cases}
\]
for $n \in \nat \ (= A)$. Then $\pi$ is bijective and, for all $n \leq n_0$ and all $m \in \nat$, $P_n^\struct{A} m$ if and only if $P_n^\struct{B} \pi(m)$. In particular, for all $n, m \in \nat$ such that $P_n \in S_0$,\\
\centerline{$P_n^\reduct{\struct{A}}{S_0} m$ \ \ \ iff\ \ \ $P_n^\reduct{\struct{B}}{S_0} \pi(m)$.}\\
Therefore, $\pi : \reduct{\struct{A}}{S_0} \iso \reduct{\struct{B}}{S_0}$.\\
\ \\
It remains to show: not $\struct{A} \finiso \struct{B}$. Note that $\infty \not\in \rg{p}$ for any partial isomorphism $p$ from $\struct{A}$ to $\struct{B}$ (because $P^\struct{B}_n \infty$ for $n \in \nat$ but meanwhile, there is no $a \in A$ such that $P^\struct{A}_n a$ for $n \in \nat$). So, there is no sequence $(I_n)_{n \in \nat}$ such that $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$ since the back-property does not hold for any $p \in I_1$ and $\infty$.\\
\ \\
\textit{Remarks.}
\begin{enumerate}[(1)]
\item The hint given in text ``for arbitrary $S$ and $S$-structures $\struct{A}, \struct{B}$ we have ($\struct{A} \equiv \struct{B}$ \ \ iff\ \ for every finite $S_0 \subset S$, $\reduct{\struct{A}}{S_0} \equiv \reduct{\struct{B}}{S_0}$)'' can easily be verified using the Coincidence Lemma.
%%
\item Consider the following two sets:
\[
\Phi \colonequals \{ \forall v_0 P_0 v_0 \} \cup \setm{\varphi_n}{n > 0} \cup \setm{\forall v_0 (P_{n + 1} v_0 \limply P_n v_0)}{n \in \nat},
\]
where $\varphi_n \in \fstordlang[0]{S}$ formulates ``there are exactly $n$ elements $\seq[1]{a}{n}$ (in the universe) for which $P_n$ does not hold,'' and
\[
\Psi \colonequals \setm{P_n v_0}{n \in \nat}.
\]
(Both are satisfied by the $S$-interpretation $\intpp{\struct{B}}{\assgn}$ where $\assgn(v_0) = \infty$.)\\
\ \\
We have:\footnote{Here we identify two structures if they are isomorphic.}
\begin{enumerate}[(a)]
\item For every $S$-structure $\struct{A}^\prime$ (with universe $A^\prime$), $\struct{A}^\prime \models \Phi$ if and only if there is a partial isomorphism $p$ from $\struct{A}^\prime$ \emph{onto} $\struct{A}$ and, moreover, for all $n \in \nat$, $P_n^{\struct{A}^\prime}$ holds for every element $a \in A^\prime \setminus \dom{p}$ (if any). In particular, $\struct{A} \models \Phi$.
%%%
\item For every $S$-structure $\struct{A}^\prime$, $\intpp{\struct{A}^\prime}{\assgn} \models \Phi \cup \Psi$ for some $\assgn$ in $\struct{A}^\prime$ if and only if $\struct{A}^\prime \models \Phi$ and not $\struct{A} \iso \struct{A}^\prime$ (this can easily be verified using the Coincidence Lemma). That is to say, all $S$-structures that are models of $\Phi$ other than $\struct{A}$ are exactly those with which the $S$-interpretations satisfy $\Phi \cup \Psi$.
\end{enumerate}
\ \\
On the other hand, for every sentence $\varphi$, $\Phi \cup \Psi \models \varphi$ if and only if $\Phi \models \varphi$: The direction from right to left is trivial. As for the other, note by the Compactness Theorem that there are finite subsets $\Phi_0 \subset \Phi$ and $\Psi_0 \subset \Psi$ such that $\Phi_0 \cup \Psi_0 \models \varphi$, of which we assume, without loss of generality, that $\Psi_0$ is not empty. So we have $\Phi_0 \cup \{ \bigwedge\Psi_0 \} \models \varphi$ and even $\Phi_0 \cup  \{ \exists v_0 \bigwedge\Psi_0 \} \models \varphi$ (using the rule IV.5.1(a)). Since $\Phi \models \exists v_0 \bigwedge\Psi_0$, it follows that $\Phi \models \varphi$.
\end{enumerate}
\end{enumerate}
%End of Section XII.2-------------------------------------------------------------
\
\\
\\
%Section XII.3--------------------------------------------------------------------
{\large \S3. Proof of Fra\"{i}ss\'{e}'s Theorem}
\begin{enumerate}[1.]
\item \textbf{Note on the Proof of 3.2.} Actually, the equivalence of (b) and (c) and of (e) and (f) is obtained by using the forth- and the back-property, respectively.
%
\item \textbf{Note on 3.3 and the Discussion before It.} Let $\struct{A}$ and $\struct{B}$ be two $S$-structures. Then by definition, we immediately have\\
\centerline{if \quad $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$ \quad then \quad $(I_n)_{n \leq m}: \struct{A} \iso_m \struct{B}$.}\\
Interestingly, by picking the sequence $(I_n)_{n \leq 0}$ which consists of only one element $I_0 = \{ \emptyset \}$ we have $(I_n)_{n \leq 0}: \struct{A} \iso_0 \struct{B}$.\\
\ \\
Also note that $m \geq 1$ for the notion of $\equiv_m$: For a relational symbol set $S$ every sentence has quantifier rank $\geq 1$.\footnote{If we allow $m = 0$, then for any two $S$-strucures $\struct{A}$ and $\struct{B}$ we have $\struct{A} \equiv_0 \struct{B}$. The claim of 3.3 in this case is also valid: If $\struct{A} \iso_0 \struct{B}$ then $\struct{A} \equiv_0 \struct{B}$.}
%
\item \textbf{Note on the Paragraph Defining $\varphi^n_{\struct{B}, \vect{b}{r}}$ below 3.3 on Page 253.} Since $S$ is a relational symbol set, there are no atomic $S$-sentences (i.e.\ $S$-sentences that are atomic formulas), and hence the case $r = 0$ for $n = 0$ in the definition of $\varphi^n_{\struct{B}, \vect{b}{r}}$ is not allowed (cf.\ 3.5(a)).\\
\ \\
Each $\varphi^{n + 1}_{\struct{B}, \vect{b}{r}}$ is defined in terms of $\varphi^n_{\struct{B}, \vect{b}{r}b}$. A visual representation for this is given below, where arrows indicate ``gives rise to'':\\
\ \\
\begin{tabular}{c|ccccccc}
\ & $0$ & \ & $1$ & \ & $2$ & $\cdots$ & $r$ \cr\hline
$0$ & \ & \ & $\bullet$ & \ & $\bullet$ & \ & \ \cr
\ & \ & $\swarrow$ & \ & $\swarrow$ & \ & \ & \ \cr
$1$ & $\bullet$ & \ & $\bullet$ & \ & $\bullet$ & \ & \ \cr
\ & \ & $\swarrow$ & \ & $\swarrow$ & \ & \ & \ \cr
$2$ & $\bullet$ & \ & $\bullet$ & \ & $\bullet$ & \ & \ \cr
$\vdots$ & \ & \ & \ & \ & \ & \ & \ \cr
$n$ & \ & \ & \ & \ & \ & \ & \ 
\end{tabular}\\
\ \\
Finally, if we define a binary relation $\sim$ over $r$-tuples of the domain $B$ of a given structure $\struct{B}$ such that for $\vect{a}{r}, \vect{b}{r} \in B^r$:
\begin{medcenter}
$\vect{a}{r} \sim \vect{b}{r}$ \ \ \ :iff \ \ \ $\struct{B} \models \varphi^n_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$
\end{medcenter}
then $\sim$ is an equivalence relation. Therefore, the set in 3.4 is a partition of $B$ into finitely many subsets. The subsets induced by the formulas $\varphi^n_{\struct{B}, \vect{b}{r}b}$ are merged to form a coarser partition when $\varphi^{n + 1}_{\struct{B}, \vect{b}{r}}$ are formed from $\varphi^n_{\struct{B}, \vect{b}{r}b}$; the definition of $\varphi^{n + 1}_{\struct{B}, \vect{b}{r}}$ formalizes the idea that ``given $\struct{B}$ and $\vect{b}{r}$, for every $b^\prime \in B$ there is some $b \in B$ such that $\struct{B} \models \varphi^n_{\struct{B}, \vect{b}{r}b}[\vect{b}{r}b^\prime]$ ($b^\prime$ is in some subset for $\varphi^n_{\struct{B}, \vect{b}{r}b}$), and for every $b \in B$ there is $b^\prime \in B$ such that $\struct{B} \models \varphi^n_{\struct{B}, \vect{b}{r}b}[\vect{b}{r}b^\prime]$ (the subset for $\varphi^n_{\struct{B}, \vect{b}{r}b}$ is nonempty).'' And with 3.6 and 3.7, if $\struct{A}$ and $\vect{a}{r}$ are such that $\struct{A} \satis \varphi^n_{\struct{B}, \vect{b}{r}}$ then $\varphi^n_{\struct{B}, \vect{b}{r}}$ formalizes the idea that the partial isomorphism $\funbyvect{\vect{a}{r}}{\vect{b}{r}}$ can be extended $n$ times using the forth- or the back-property.
%
\item \textbf{Induction Proof of 3.4.} In fact, it is more convenient to prove at the same time both 3.4 and the remark below it that the conjunctions and disjunctions (if any) occurring in the definition of $\varphi^n_{\struct{B}, \vect{b}{r}}$ are all finite, which implies that the $\varphi^n_{\struct{B}, \vect{b}{r}}$ are first-order formulas:
\medskip\\
\emph{The $\varphi^n_{\struct{B}, \vect{b}{r}}$ are well-formed first-order formulas - i.e.\ the conjunctions and disjunctions (if any) occurring in them are finite - and the set\\$\sett{\varphi^n_{\struct{B}, \vect{b}{r}}}{\(\struct{B}\) is an \(S\)-structure and \(\vect{b}{r} \in B\)}$ is finite.}
\begin{proof}
We prove it by induction on $n$.
\bigskip\\
The basis step $n = 0$: Let $r > 0$ be given. Then for any $S$-structure $\struct{B}$ and any $\vect{b}{r} \in B$, $\varphi^0_{\struct{B}, \vect{b}{r}}$ is a conjunction over a subset of $\Phi_r$. Since $\Phi_r$ is finite, it follows that this subset is also finite and $\varphi^0_{\struct{B}, \vect{b}{r}}$ is indeed a first-order formula; moreover, there are only finitely many different subsets of $\Phi_r$ in total, and this implies that the set $\sett{\varphi^0_{\struct{B}, \vect{b}{r}}}{\(\struct{B}\) is an \(S\)-structure and \(\vect{b}{r} \in B\)}$ is finite as well.
\bigskip\\
The induction step $n > 0$: Let $r \in \nat$ be given, and suppose that $\varphi^{n - 1}_{\struct{B}, \vect{b}{r}b}$ is a first-order formula for any $\struct{B}$ and any $\vect{b}{r}b \in B$ and that the set $\sett{\varphi^{n - 1}_{\struct{B}, \vect{b}{r}b}}{\(\struct{B}\) is an \(S\)-structure and \(\vect{b}{r}b \in B\)}$ is finite (hence it has only finitely many different subsets). Given $\struct{B}$ and $\vect{b}{r}$, the disjunction and conjunction occurring in $\varphi^n_{\struct{B}, \vect{b}{r}}$ are taken over a subset of the above set and a set consisting of formulas from this subset prefixed by $\exists v_r$, respectively, and both sets are obviously finite. It immediately follows that $\varphi^n_{\struct{B}, \vect{b}{r}}$ is a first-order formula for any $\struct{B}$ and any $\vect{b}{r}$ and that the set $\sett{\varphi^n_{\struct{B}, \vect{b}{r}}}{\(\struct{B}\) is an \(S\)-structure and \(\vect{b}{r} \in B\)}$ is finite.
\end{proof}
\begin{remark}
Recall that in Exercise 2.6 the symbol set $S = \setm{P_n}{n \in \nat}$ is infinite, therefore the set $\Phi_r$ in this case is infinite for $r > 0$ and the sets mentioned in 3.4 are infinite as well. Consequently, the $\varphi^n_{\struct{B}, \vect{b}{r}}$ are not first-order formulas.
\end{remark}
%
\item \textbf{Induction Proof of 3.5(a).} Let $\struct{B}$ and $\vect{b}{r} \in B$ be given.\\
\ \\
The base case $n = 0$: $\Phi_r \subset \fstordlang[r]{S}$, so it is clear from the definition that $\varphi^0_{\struct{B}, \vect{b}{r}} \in \fstordlang[r]{S}$. On the other hand, $\varphi^0_{\struct{B}, \vect{b}{r}}$ is a conjunction of atomic or negated atomic formulas, so $\qr{\varphi^0_{\struct{B}, \vect{b}{r}}} = 0$.\\
\ \\
Induction step: Let $b \in B$. Assume that $\varphi^n_{\struct{B}, \vect{b}{r}b} \in \fstordlang[r + 1]{S}$ and that $\qr{\varphi^n_{\struct{B}, \vect{b}{r}b}} = n$ have already been shown. From the definition it follows that $\varphi^{n + 1}_{\struct{B}, \vect{b}{r}} \in \fstordlang[r]{S}$ and $\qr{\varphi^{n + 1}_{\struct{B}, \vect{b}{r}}} = n + 1$.
%
\item \textbf{Note on the Last Paragraph (below the Proof of 3.8) on Page 254.} There is a typo in the fourth line from the bottom of page 254: ``the direction'' should be replaced by ``the other direction''.\\
\ \\
On the other hand, the argument in the second and the third lines of this paragraph yields for $n \geq 1$, $J_n \neq \emptyset$; in particular, $J_1 \neq \emptyset$. Then also $J_0 \neq \emptyset$ since $(J_n)_{n \in \nat}$ has the back- and the forth-property (cf.\ 3.8(b)).
%
\item \textbf{Note on Theorems 3.9 and 3.10.} The equivalence of the statements (a) - (d) in 3.9 follows from the implications below:\smallskip\\
\begin{tabular}{rl}
(a) implies (b): & Since $\struct{B} \models \varphi^n_{\struct{B}}$ for $n \in \nat$. \cr
(b) implies (c): & By 3.8. \cr
(c) implies (d): & By definition of the notation ``$(J_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$''. \cr
(d) implies (a): & By 3.1.
\end{tabular}
\smallskip\\
The equivalence of the corresponding statments in 3.10 can be argued likewise.
%
\item \textbf{Note on Theorem 3.11.} Despite that there is no (single) $\setenum{R}$-sentence whose finite models are the finite connected graphs, the class in which finite models are exactly the finite connected graphs (while infinite ones are the infinite graphs, connected or not) is $\Delta$-elementary: Take the set
\[
\setenum{\varphi_{=2} \limply \forall v_0 \forall v_1 (\neg v_0 \equal v_1 \limply R v_0 v_1)} \union \setm{\varphi_{=n} \limply \psi_n}{n \geq 3}
\]
where $\varphi_{=n}$, $n \geq 2$, formalizes ``there are exactly $n$ elements'' (cf.\ III.6.3) and $\psi_n$, $n \geq 3$, formalizes ``for any two different elements there is a path of length $1$, $2$, \ldots or $n$ between them''.
%
\item \textbf{More about Finite Isomorphism and Elementary Equivalence.}
\begin{claim}
Let $S$ be a relational symbol set and $\struct{A}$ and $\struct{B}$ be $S$-structures. Then
\begin{enumerate}[\rm (a)]
%%
\item $\struct{A} \finiso \struct{B}$ \ \ \ iff \ \ \ $\struct{A} \iso_m \struct{B}$ for $m \in \nat$;
%%
\item $\struct{A} \equiv \struct{B}$ \ \ \ iff \ \ \ $\struct{A} \equiv_m \struct{B}$ for $m > 0$.
%%
\end{enumerate}
\end{claim}
\begin{proof}
For (a), if $\seqi{I_n}{n \in \nat} : \struct{A} \finiso \struct{B}$ and $m \in \nat$, then $\seqi{I_n}{n \leq m} : \struct{A} \iso_m \struct{B}$. Conversely, if $\seqi{I^\prime_{m, n}}{n \leq m} : \struct{A} \iso_m \struct{B}$ for $m \in \nat$, then $\seqi{I^\prime_n}{n \in \nat} : \struct{A} \finiso \struct{B}$ where $I^\prime_n \defas \bunion_{m \geq n} I^\prime_{m, n}$.
\medskip\\
For (b) the equivalnece is obvious because the quantifier rank of any $S$-sentence is a positive integer.
\end{proof}
%
\item \textbf{Note on the Proof of Theorem 3.11.} There are several typos:
\begin{enumerate}[(1)]
\item Line 6 on page 256 (line 2 of the second paragraph): the right parenthesis ``$)$'' appearing in ``$H_k \times H_k)$'' is redundant.
%%
\item Line 8 on the same page (line 2 of the definition of $d_n$): ``$2^m$'' should be replaced by ``$2^n$''.
%%
\item Line 12 on the same page (line 1 of the definition of $I_n$): the condition ``$\dom{p}$ is finite, and for all $a, b \in G_k$, $d_n(a, b) = {d_n}^\prime(p(a), p(b))$'' should be replaced by ``$\dom{p}$ contains at most $m - n$ elements, and for all $a, b \in \dom{p}$, $d_n(a, b) = {d_n}^\prime(p(a), p(b))$''.\\
\ \\
The restriction on the size of $p \in I_n$ in text, namely ``$\dom{p}$ is finite'', is not appropriate. Consider $k = 2^m$, $n = 1$ and $p$ where $\dom{p} = G_k$ and $p(i) = \pair{i}{0}$ for $0 \leq i \leq k$: The back-property cannot be applied to $p$ and $\pair{j}{1} \in H_k$ for any $0 \leq j \leq k$, as $G_k$ is already ``filled up'' with elements in $\dom{p}$.\\
\ \\
On the other hand, the condition $a, b \in \dom{p}$, instead of ``$a, b \in G_k$'' in text, is essential because $p(a)$ and $p(b)$ would be left undefined should $a$ and $b$ be elements in $G_k \setminus \dom{p}$.
\end{enumerate}
\ \\
\textit{Remark.} This theorem appears in Example 2.3.8 of \cite{Heinz_Dieter_Ebbinghaus_and_Jorg_Flum}.
%
\item \textbf{Solution to Exercise 3.12.} Assume that $B = \{ \seq[1]{b}{n} \}$, and let an $S$-structure $\struct{A}$ be given. Moreover, let the sequence $(J_n)_{n \in \nat}$ for $\struct{A}$ and $\struct{B}$ be defined as in text.\\
\ \\
For the direction from left to right, suppose that $\struct{A} \iso \struct{B}$. Since $\struct{B} \models \varphi^{n + 1}_{\struct{B}}$ (cf.\ 3.5(b)), by the Isomorphism Lemma we have $\struct{A} \models \varphi^{n + 1}_{\struct{B}}$.\\
\ \\
Conversely, for the direction from right to left, suppose that $\struct{A} \models \varphi^{n + 1}_{\struct{B}}$. By 3.10 we have $(J_m)_{m \leq n + 1}: \struct{A} \iso_{n + 1} \struct{B}$. Let $p \in I_{n + 1}$. Successively applying the back-property to $p$ and $\seq[1]{b}{n}$ yields a $q \in I_1$ such that $\rg{q} = B$ (so both $\dom{q}$ and $\rg{q}$ are of size $n$). We have $q: \struct{A} \iso \struct{B}$ because $A \setminus \dom{q} = \emptyset$: If $a \not\in \dom{p}$ for some $a \in A$, then by applying the forth-property to $q$ and $a$ we obtain a $q^\prime \in I_0$ such that $q^\prime \supset q$ and $a \in \dom{q^\prime}$, of which the domain $\dom{q^\prime}$ contains exactly $n + 1$ elements; it turns out that $\rg{q^\prime}$ contains exactly $n + 1$ elements as well. However, this is absurd because $\rg{q^\prime} \subset B$.
\begin{remark}
The equivalence may not be valid, i.e.\ the direction from right to left may fail, if $\varphi^{n + 1}_{\struct{B}}$ is replaced by $\varphi^n_{\struct{B}}$: Consider the case in which $S = \emptyset$ and $A$ contains $n + 1$ elements. The content of this exercise also appears in Corollary 2.2.10 of \cite{Heinz_Dieter_Ebbinghaus_and_Jorg_Flum}.
\end{remark}
%
\item \textbf{Solution to Exercise 3.13.} Let $n$ and $r$ (with $n + r > 0$) and $\vect{b}{r} \in B$ be given. We need to show:\\
\centerline{For all $S$-structures $\struct{A}$ and all $\vect{a}{r} \in A$, $\struct{A} \models (\varphi^{n + 1}_{\struct{B}, \vect{b}{r}} \limply \varphi^n_{\struct{B}, \vect{b}{r}})[\vect{a}{r}]$.}\\
We distinguish two cases: $r = 0$ or $r > 0$.\medskip\\
For $r = 0$ (and $n > 0$): Let $\struct{A}$ be an $S$-structure. Assume that $\struct{A} \models \varphi^{n + 1}_\struct{B}$. Then $\struct{A} \equiv_{n + 1} \struct{B}$ by 3.10. Since $\qr{\varphi^n_\struct{B}} = n < n + 1$, we have $\struct{A} \models \varphi^n_\struct{B}$ because $\struct{B} \models \varphi^n_\struct{B}$ (cf.\ 3.5).\\
\ \\
For $r > 0$: Let $\struct{A}$ be an $S$-structure and let $\vect{a}{r} \in A$. Assume that $\struct{A} \models \varphi^{n + 1}_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$. By definition, $\vect{a}{r} \mapsto \vect{b}{r} \in J_{n + 1}$ (the sequence $(J_n)_{n \in \nat}$ for $\struct{A}$ and $\struct{B}$ is defined as in text). Since $(J_n)_{n \in \nat}$ has the forth-property (cf.\ 3.8(b)), there is a map, say, $\vect{a}{r}a_0 \mapsto \vect{b}{r}b_0$, in $J_n$, which extends $\vect{a}{r} \mapsto \vect{b}{r}$ and whose domain contains $a_0$. But $\vect{a}{r}a_0 \mapsto \vect{b}{r}b_0$ is identical to $\vect{a}{r} \mapsto \vect{b}{r}$, therefore we have $\vect{a}{r} \mapsto \vect{b}{r} \in J_n$, i.e.\ $\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$.
%
\item \textbf{Solution to Exercise 3.14.} There is a typo in line 2 of this exercise: ``$\psi^{n + 1}_{\struct{B}, \vect{b}{r}}$'' should be replaced by ``$\psi^n_{\struct{B}, \vect{b}{r}}$'' (since these formulas are defined for all natural numbers, not just for positive integers).\\
\ \\
Let an $S$-structure $\struct{B}$ be given.
\begin{enumerate}[(a)]
\item First note that, similarly to 3.4, we can easily use induction on $n$ to show the set $\setm{\psi^n_{\struct{B}, \vect{b}{r}}}{\vect{b}{r} \in B}$
is finite (cf. \textbf{Induction Proof of 3.4}). The disjunctions occurring in the definition are therefore finte, so the $\psi^n_{\struct{B}, \vect{b}{r}}$ are first-order formulas.\\
\ \\
Next, we show they are universal by induction on $n$:\smallskip\\
The base case $n = 0$ (and $r > 0$): Given $\vect{b}{r} \in B$, we have $\psi^0_{\struct{B}, \vect{b}{r}} = \varphi^0_{\struct{B}, \vect{b}{r}}$, which is quantifier-free and hence universal.\medskip\\
The inductive case: Let $\vect{b}{r} \in B$ be given. By induction hypothesis, $\setm{\psi^n_{\struct{B}, \vect{b}{r}b}}{b \in B}$ is a set of universal formulas; since this set is finite, $\bigvee\setm{\psi^n_{\struct{B}, \vect{b}{r}b}}{b \in B}$ is a universal formula and so is $\forall v_r \bigvee\setm{\psi^n_{\struct{B}, \vect{b}{r}b}}{b \in B} = \psi^{n + 1}_{\struct{B}, \vect{b}{r}}$.
%%
\item Let an $S$-structure $\struct{A}$ be given. Then we have the following results on $\psi^n_{\struct{B}, \vect{b}{r}}$ which are counterparts of those on $\varphi^n_{\struct{B}, \vect{b}{r}}$:
\begin{enumerate}[(I)]
\item \emph{Let $\vect{b}{r} \in B$. Then: $\psi^n_{\struct{B}, \vect{b}{r}} \in L^S_r$ and $\qr{\psi^n_{\struct{B}, \vect{b}{r}}} = n$; moreover, $\struct{B} \models \psi^n_{\struct{B}, \vect{b}{r}}[\vect{b}{r}]$.}
%%%
\item \emph{Let $\vect{a}{r} \in A$ and $\vect{b}{r} \in B$. Then: $\struct{A} \models \psi^0_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$ \quad iff \quad $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$.}
%%%
\item \emph{If $\vect{a}{r} \in A$ and $\vect{b}{r} \in B$, and if $\struct{A} \models \psi^n_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$, then $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$.}
%%%
\item \emph{For $n \in \nat$, we set (analogous to $J_n$)
\[
K_n \colonequals \sett{\vect{a}{r} \mapsto \vect{b}{r}}{\(r \in \nat, \vect{a}{r} \in A, \vect{b}{r} \in B\) and \(\struct{A} \models \psi^n_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]\)}.
\]
Then we obtain:
\begin{enumerate}[\rm(i)]
\item $K_n \subset \partism{\struct{A}}{\struct{B}}$;
%%%%
\item $(K_n)_{n \in \nat}$ has the forth-property;
%%%%
\item If $n > 0$ and $\struct{A} \models \psi^n_{\struct{B}}$ then $\emptyset \in K_n$, hence $K_n \neq \emptyset$.
\end{enumerate}}
%%%
\item \emph{Assume $(I_n)_{n \in \nat}: \struct{A} \finemb \struct{B}$. Then for every \emph{universal} formula $\varphi$:
\begin{quote}
If $\varphi \in \fstordlang[r]{S}$, $\qr{\varphi} \leq n$, $p \in I_n$ and $\seq{a}{r - 1} \in \dom{p}$, and if $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$, then $\struct{A} \models \varphi[\seq{a}{r - 1}]$.
\end{quote}}
\end{enumerate}
\ \\
The above (I) - (V) are analogous to 3.5, 3.6, 3.7, 3.8 and 3.2, respectively. For (I), the \emph{proof} is symmetrical to that of 3.5, except that we do not consider $\struct{B} \models \exists v_r \psi^n_{\struct{B}, \vect{b}{r}b^\prime}[\vect{b}{r}]$ or $\struct{B} \models \bigwedge\setm{\exists v_r \psi^n_{\struct{B}, \vect{b}{r}b^\prime}}{b^\prime \in B}[\vect{b}{r}]$. For (II), it directly follows from 3.6 because $\varphi^0_{\struct{B}, \vect{b}{r}} = \psi^0_{\struct{B}, \vect{b}{r}}$. For (III), the \emph{proof} is symmetrical to that of 3.7, except that the claim for the base case follows from (II). For (IV), again, the \emph{proof} is symmetrical to that of 3.8, except that statement (i) follows from (III), that for statement (ii) we do not have to prove the back-property holds for $(K_n)_{n \in \nat}$ (note that, of course, $(K_n)_{n \in \nat}$ may not have the back-property), and that statement (iii) follows from the definition of $K_n$.\\
\ \\
Only for (V) the proof requires some work. First note that the part for cases (i) - (iii) of the proof of 3.2 given in text also validates the following statement:\smallskip\\
\begin{bquoteno}{64ex}{($\ast$)}
Let $\struct{A}$ and $\struct{B}$ be two $S$-structures. If $\varphi \in \fstordlang[r]{S}$ is a \emph{quantifier-free} formula, $p$ is a partial isomorphism from $\struct{A}$ to $\struct{B}$, and if $\seq{a}{r - 1} \in \dom{p}$, then\\
$\struct{A} \models \varphi[\seq{a}{r - 1}]$ \quad iff \quad $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$.
\end{bquoteno}\bigskip\\
Next, we show the statement in (V) holds by induction on $\varphi$:
\begin{proof} Suppose $\varphi$ is a universal formula in $\fstordlang[r]{S}$, $\qr{\varphi} \leq n$, $p \in I_n$ and $\seq{a}{r - 1} \in \dom{p}$.\medskip\\
For quantifier-free formula $\varphi$, the claim immediately follows from ($\ast$).\medskip\\
For $\varphi = \psi \lor \chi$: $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$\smallskip\\
\begin{tabular}{ll}
iff  & $\struct{B} \models \psi[\seqp{p(a_0)}{p(a_{r - 1})}]$ or $\struct{B} \models \chi[\seqp{p(a_0)}{p(a_{r - 1})}]$ \cr
then & $\struct{A} \models \psi[\seq{a}{r - 1}]$ or $\struct{A} \models \chi[\seq{a}{r - 1}]$ \cr
\    & (by induction hypothesis) \cr
iff  & $\struct{A} \models \varphi[\seq{a}{r - 1}]$.
\end{tabular}\medskip\\
For $\varphi = \psi \land \chi$: The argument is analogous.\medskip\\
For $\varphi = \forall x \psi$: Similarly to the argument for case (iv) in the proof of 3.2, we may assume that $x = v_r$. Also, because $\qr{\varphi} = \qr{\forall x \psi} \leq n$, we have $\qr{\psi} \leq n - 1$. We prove the claim as follows:\smallskip\\
\begin{tabular}[b]{ll}
\    & not $\struct{A} \models \varphi[\seq{a}{r - 1}]$ \cr
iff  & not (for all $a \in A$, $\struct{A} \models \psi[\seq{a}{r - 1}, a]$) \cr
iff  & there is $a \in A$ such that not $\struct{A} \models \psi[\seq{a}{r - 1}, a]$ \cr
iff  & \begin{minipage}[t]{56ex}there is $a \in A$ and $q \in I_{n - 1}$ such that $q \supset p$, $a \in \dom{q}$, and not $\struct{A} \models \psi[\seq{a}{r - 1}, a]$\\(by the forth-property of the sequence $(I_n)_{n \in \nat}$)\end{minipage} \cr
then & \begin{minipage}[t]{56ex}there is $a \in A$ and $q \in I_{n - 1}$ such that $q \supset p$, $a \in \dom{q}$, and not $\struct{B} \models \psi[\seqp{p(a_0)}{p(a_{r - 1})}, q(a)]$\\(by induction hypothesis)\end{minipage} \cr
iff  & \begin{minipage}[t]{56ex}there is $b \in B$ and $q \in I_{n - 1}$ such that $q \supset p$, $b \in \rg{q}$, and not $\struct{B} \models \psi[\seqp{p(a_0)}{p(a_{r - 1})}, b]$\end{minipage} \cr
then & there is $b \in B$ such that not $\struct{B} \models \psi[\seqp{p(a_0)}{p(a_{r - 1})}, b]$ \cr
iff  & not (for all $b \in B$, $\struct{B} \models \psi[\seqp{p(a_0)}{p(a_{r - 1})}, b]$) \cr
iff  & not $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$.
\end{tabular}
\end{proof}
Now the claim in this part of exercise immediately follows:
\begin{itemize}
\item (1) implies (2): Assume (1) holds. Then for all $n \geq 1$, we have $\struct{A} \models \psi^n_{\struct{B}}$ since $\struct{B} \models \psi^n_{\struct{B}}$ by (I). So (2) holds as well.
%%%
\item (2) implies (3): Assume (2) holds. Then for $n \geq 1$, $K_n \neq \emptyset$ by (IV)(iii). Hence $K_0 \neq \emptyset$ by (IV)(ii) (apply the forth-property to an arbitrary $p \in K_1$ and some $a \in A$). Therefore $(K_n)_{n \in \nat}: \struct{A} \finemb \struct{B}$ and (3) holds as well.
%%%
\item (3) implies (1): Assume (3) holds. Then (1) immediately follows from (V) by taking $r = 0$, $n = \qr{\varphi}$ and an arbitrary $p \in I_n$ for each universal  $S$-sentence $\varphi$ considered in (1).
\end{itemize}
%%
\item Analogous to the notion of $m$-isomorphic, we say that two structures $\struct{A}$ and $\struct{B}$ are \emph{$m$-embeddable} (written: $\struct{A} \emb_m \struct{B}$) if  there is a sequence $\seq{I}{m}$ of nonempty sets of partial isomorphisms from $\struct{A}$ to $\struct{B}$ with the forth-property, i.e.,
\begin{quote}
for $n + 1 \leq m$, $p \in I_{n + 1}$ and $a \in A$, there is $q \in I_n$ such that $q \supset p$ and $a \in \dom{q}$.
\end{quote}
In this case, we write $(I_n)_{n \leq m}: \struct{A} \emb_m \struct{B}$.\\
\ \\
Then we formulate and prove the version analogous to 3.10 below:\smallskip\\
For an $S$-structure $\struct{A}$ and for $m \geq 1$ the following are equivalent:
\begin{enumerate}[(1)]
\item $\struct{A}$ satisfies every universal $S$-sentence of quantifier rank $\leq m$ which holds in $\struct{B}$.
%%%
\item $\struct{A} \models \psi^m_\struct{B}$.
%%%
\item $\struct{A} \emb_m \struct{B}$.
\end{enumerate}
\begin{proof}
Since $\qr{\psi^m_\struct{B}} = m$ (see (I) in part (b)), (2) follows from (1).\\
\ \\
For the direction from (2) to (3), the argument is analogous to that of 3.10: Because of the forth-property of the sequence $(K_n)_{n \in \nat}$ (see (IV)(ii) in part (b)), if $K_m \neq \emptyset$, then also $K_n \neq \emptyset$ for $n < m$.\\
\ \\
Finally, notice that in case $(I_n)_{n \leq m}: \struct{A} \emb_m \struct{B}$, the proof of (V) in part (b) shows that each $p \in I_n$ (with $n \leq m$) preserves the validity of universal formulas of quantifier rank $\leq n$ in $\struct{A}$ provided that these formulas hold in $\struct{B}$ (cf.\ the discussion before 3.3). Hence, analogous to 3.3, we obtain the direction from (3) to (1).
\end{proof}
\end{enumerate}
%
\item \textbf{Solution to Exercise 3.15.} For convenience, we introduce a syntactic form of formulas similar to that of term-reduced formulas (cf.\ \reftitle{VIII.1.1}). Let $S$ be a symbol set. For $\varphi \in \fstordlang{S}$, we define $\varphi^\ast \in \fstordlang{S}$ inductively as follows:\smallskip\\
First, for formulas of simple forms:
\[
\begin{array}{lll}
[y \equal x]^\ast & \colonequals & y \equal x; \cr
[c \equal x]^\ast & \colonequals & c \equal x; \cr
[x \equal c]^\ast & \colonequals & c \equal x; \cr
[f\enum[1]{x}{n} \equal x]^\ast & \colonequals & f\enum[1]{x}{n} \equal x; \cr
[R\enum[1]{x}{n}]^\ast & \colonequals & R\enum[1]{x}{n}.
\end{array}
\]
Second, assume that $\seq[1]{t}{n}$ are terms and that at least one of them is not a variable. Let $1 \leq \enumpop{i_1}{<}{i_s} \leq n$ such that $\seq[i_1]{t}{i_s}$ are exactly those terms among $\seq[1]{t}{n}$ that are not variables. Then
\[
[f\enum[1]{t}{n} \equal x]^\ast \colonequals \enump{\exists x_{i_1}}{\exists x_{i_s}}\psi,
\]
in which $\psi$ is the formula in prenex normal form that is logically equivalent to
\[
\parenadj{\bigwedge\limits^s_{r = 1} [t_{i_r} \equal x_{i_r}]^\ast \land f\enum[1]{x}{n} \equal x},
\]
where $\seq[1]{x}{n}$ are variables in the list $v_0, v_1, v_2, \ldots$ in which $\seq[i_1]{x}{i_s}$ are pairwise distinct and are not in $\{ x \} \cup \parenadj{\bigcup\limits^n_{j = 1}\var{t_j}}$ and furthermore, for $1 \leq k \leq n$, if $k \not\in \{ \seq[1]{i}{s} \}$ then $t_k = x_k$.\\
\ \\
Third, if $\seq[1]{t}{n}$ are terms then
\[
[x \equal f\enum[1]{t}{n}]^\ast \colonequals [f\enum[1]{t}{n} \equal x]^\ast.
\]
Fourth, if both $t_1$ and $t_2$ are not variables then
\[
[t_1 \equal t_2]^\ast \colonequals \exists x \psi,
\]
in which $\psi$ is the formula in prenex normal form that is logically equivalent to
\[
([t_1 \equal x]^\ast \land [t_2 \equal x]^\ast),
\]
where $x$ is a variable not in $\var{t_1} \cup \var{t_2}$.\\
\ \\
Fifth, if $\seq[1]{t}{n}$ are terms and at least one of them is not a variable, and if $1 \leq \enumpop{i_1}{<}{i_s} \leq n$ such that $\seq[i_1]{t}{i_s}$ are exactly those terms among $\seq[1]{t}{n}$ that are not variables, then
\[
[R\enum[1]{t}{n}]^\ast \colonequals \enump{\exists x_{i_1}}{\exists x_{i_s}} \psi,
\]
in which $\psi$ is the formula in prenex normal form that is logically equivalent to
\[
\parenadj{\bigwedge^s_{r = 1} [t_{i_r} \equal x_{i_r}]^\ast \land R\enum[1]{x}{n}},
\]
where $\seq[1]{x}{n}$ are variables in the list $v_0, v_1, v_2, \ldots$ in which $\seq[i_1]{x}{i_s}$ are pairwise distinct and are not in $\bigcup\limits^n_{j = 1}\var{t_j}$ and furthermore, for $1 \leq k \leq n$, if $k \not\in \{ \seq[1]{i}{s} \}$ then $t_k = x_k$.\\
\ \\
Finally, we set
\[
\begin{array}{lll}
[\neg\varphi]^\ast & \colonequals & \neg\varphi^\ast; \cr
(\varphi \lor \psi)^\ast & \colonequals & (\varphi^\ast \lor \psi^\ast); \cr
[\exists x \varphi]^\ast & \colonequals & \exists x \varphi^\ast.
\end{array}
\]
Notice that\smallskip\\
\begin{bquoteno}{68ex}{($+$)}
\emph{for atomic formulas $\varphi$, $\varphi^\ast$ is in prenex normal form and the number of quantifiers therein is $\mrk{\varphi}$.}
\end{bquoteno}\smallskip\\
This can be verified by a simple induction on (the form of) atomic formulas $\varphi$:
\begin{proof} For formulas $\varphi$ of the form $y \equal x$, $c \equal x$, $x \equal c$, $f\enum[1]{x}{n} \equal x$ or $R\enum[1]{x}{n}$, the claim is trivially true.\medskip\\
For $\varphi = f\enum[1]{t}{n} \equal x$ in which some $t_j$ is not a variable, by definition we have $\varphi^\ast = \enump{\exists x_{i_1}}{\exists x_{i_s}} \psi$, where $\psi$ is the formula in prenex normal form that is logically equivalent to
\[
\parenadj{\bigwedge\limits^s_{r = 1} [t_{i_r} \equal x_{i_r}]^\ast \land f\enum[1]{x}{n} \equal x}.
\]
So $\varphi$ is also in prenex normal form. Moreover, by induction hypothesis we have for $1 \leq r \leq s$ that the number of quantifiers in $[t_{i_r} \equal x_{i_r}]^\ast$ is $\mrk{t_{i_r} \equal x_{i_r}}$; hence the number of quantifiers in $\psi$ is $\left(\sum^s_{r = 1} \mrk{t_{i_r} \equal x_{i_r}}\right)$, and so the number of quantifiers in $\varphi$ is
\[
\begin{array}{ll}
\ & s + \displaystyle\sum\limits^s_{r = 1} \mrk{t_{i_r} \equal x_{i_r}} \cr
= & s + \displaystyle\sum\limits^s_{r = 1} (\mrk{t_{i_r}} - 1) \cr
= & s + \left(\displaystyle\sum\limits^s_{r = 1} \mrk{t_{i_r}}\right) - s \cr
= & \left(\displaystyle\sum\limits^s_{r = 1} \mrk{t_{i_r}}\right) \cr
= & \left(\displaystyle\sum\limits^n_{j = 1} \mrk{t_j}\right) \cr
= & \left(\left(\displaystyle\sum\limits^n_{j = 1} \mrk{t_j}\right) + 1\right) - 1 \cr
= & \mrk{f\enum[1]{t}{n}} - 1 \cr
= & \mrk{f\enum[1]{t}{n} \equal x}.
\end{array}
\]
The cases $\varphi = R\enum[1]{t}{n}$ or $\varphi = t_1 \equal t_2$ are similar.\medskip\\
Finally, the case $\varphi = x \equal f\enum[1]{t}{n}$ immediately follows by definition and induction hypothesis.
\end{proof}
It can be shown by induction on $\varphi$ that for $\varphi \in \fstordlang{S}$:\smallskip\\
\begin{bquoteno}{68ex}{($\ast$)}
\emph{$\free{\varphi} = \free{\varphi^\ast}$, $\varphi$ is logically equivalent to $\varphi^\ast$ (cf.\ \reftitle{VIII.1.2}), and $\mrk{\varphi} = \mrk{\varphi^\ast}$.}
\end{bquoteno}\smallskip\\
Here we only prove the last statement:
\begin{proof}
If $\varphi$ is of simple form $y \equal x$, $c \equal x$, $x \equal c$, $f\enum[1]{x}{n} \equal x$ or $R\enum[1]{x}{n}$, then the claim is trivially true.\\
\ \\
If $\varphi = f\enum[1]{t}{n} \equal x$ in which some $t_j$ is not a variable then, by ($+$), $\mrk{\varphi}$ is equal to the number of quantifiers in $\varphi^\ast$. Since $\varphi^\ast$ is in prenex normal form (also by ($+$)) and its matrix is a conjunction of atomic formulas of the form $y \equal z$, $c \equal z$ or $g\enum[1]{z}{m} \equal z$ (which have modified quantifier rank $0$), $\mrk{\varphi^\ast}$ is also equal to the number of quantifiers in $\varphi^\ast$. The claim is true.\\
\ \\
The cases $\varphi = R\enum[1]{t}{n}$ or $\varphi = t_1 \equal t_2$ are similar.\\
\ \\
The claim is also true for the remaining cases $\varphi = x \equal f\enum[1]{t}{n}$, $\varphi = \neg\psi$, $\varphi = (\psi \lor \chi)$ or $\varphi = \exists x \psi$, which immediately follow by induction hypothesis.
\end{proof}
Now we are ready to prove the claims in this exercise.
\begin{enumerate}[(a)]
\item Let a finite symbol set $S$ be given.\\
\ \\
We state and prove the counterpart of 3.2:\medskip\\
\emph{Let $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$. Then for every formula $\varphi$:\smallskip\\
\emph{\begin{bquoteno}{62ex}{($\ast\ast$)}
\emph{If $\varphi \in \fstordlang[r]{S}$, $\mrk{\varphi} \leq n$, $p \in I_n$ and $\enum{a}{r - 1} \in \dom{p}$, then\\
$\struct{A} \models \varphi[\seq{a}{r - 1}]$ \quad iff \quad $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$.}
\end{bquoteno}}}
\begin{proof}
Assume that $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$. By ($\ast$) it suffices to show ($\ast\ast$) holds for all formulas $\varphi \in \fstordlang[r]{S}$ for which $\varphi^\ast = \varphi$. This is done by induction on these formulas. Suppose $\varphi \in \fstordlang[r]{S}$, $\mrk{\varphi} \leq n$, $p \in I_n$ and $\seq{a}{r - 1} \in \dom{p}$.\smallskip\\
For $\varphi = y \equal x$ or $\varphi = R\enum[1]{x}{m}$ the claim was proved in 1.2(c).\medskip\\
If $\varphi = c \equal v_i$ where $0 \leq i < r$: Then $\struct{A} \models \varphi[\seq{a}{r - 1}]$\smallskip\\
\begin{tabular}{ll}
iff & $c^\struct{A} = a_i$ \cr
iff & \begin{minipage}[t]{\DefaultTabularizedArgumentLength}$c^\struct{B} = p(a_i)$ \quad (since $p \in \partism{\struct{A}}{\struct{B}}$ and $a_i \in \dom{p}$)\end{minipage} \cr
iff & $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$.
\end{tabular}\medskip\\
If $\varphi = f\enum[i_1]{v}{i_m} \equal v_{i_{m + 1}}$ where $0 \leq \seq[1]{i}{m + 1} < r$: Then $\struct{A} \models \varphi[\seq{a}{r - 1}]$\smallskip\\
\begin{tabular}{ll}
iff & $f^\struct{A} (\seq[i_1]{a}{i_m}) = a_{i_{m + 1}}$ \cr
iff & \begin{minipage}[t]{\DefaultTabularizedArgumentLength}$f^\struct{B} (\seqp{p(a_{i_1})}{p(a_{i_m})}) = p(a_{i_{m + 1}})$ \quad (since $p \in \partism{\struct{A}}{\struct{B}}$ and $\seq[i_1]{a}{i_{m + 1}} \in \dom{p}$)\end{minipage} \cr
iff & $\struct{B} \models \varphi[\seqp{p(a_0)}{p(a_{r - 1})}]$.
\end{tabular}\medskip\\
The remaining cases $\varphi = \neg\psi$, $\varphi = (\psi_0 \lor \psi_1)$ or $\varphi = \exists x \psi$ have already been settled in the corresponding parts of the proof of 3.2 in text.
\end{proof}
By taking $r = 0$, $n = \mrk{\varphi}$ and an arbitrary $p \in I_n$, we obtain from the above result the counterpart of 3.1 (this time $S$ is any finite symbol set!):\smallskip\\
\begin{quoteno}{(1)}
\emph{If $\struct{A} \finiso \struct{B}$ then $\struct{A} \equiv \struct{B}$.}
\end{quoteno}\\
\ \\
As in the discussion before 3.3 in text, if we write $\struct{A} \equiv^\prime_m \struct{B}$ in case $\struct{A}$ and $\struct{B}$ satisfy the same sentences of modified quantifier rank $\leq m$ (note that $m \geq 1$ since sentences have modified quantifier rank $\geq 1$), then from the previous proof we likewise have\smallskip\\
\begin{quoteno}{(1)$^\prime$}
\emph{If $\struct{A} \iso_m \struct{B}$ then $\struct{A} \equiv^\prime_m \struct{B}$.}
\end{quoteno}\\
\ \\
In the following we are focused on proving the converse of (1).\medskip\\
Since $S$ is finite, ${\Phi_r}^\prime$ is also finite, and in particular ${\Phi_0}^\prime = \emptyset$. For $S$-structures $\struct{B}$ and for $n, r \in \nat$ (with $n + r > 0$), let the formulas $\varphi^n_{\struct{B}, \vect{b}{r}}$ be defined as in text.\\
\ \\
Then we have the following results corresponding to 3.4 - 3.8, respectively:
\begin{enumerate}[(I)]
\item \emph{The set $\sett{\varphi^n_{\struct{B}, \vect{b}{r}}}{\(\struct{B}\) is an \(S\)-structure and \(\vect{b}{r} \in B\)}$ is finite.}
%%%
\item \emph{Let $\struct{B}$ be an $S$-structure and $\vect{b}{r} \in B$. Then: $\varphi^n_{\struct{B}, \vect{b}{r}} \in \fstordlang[r]{S}$ and $\mrk{\varphi^n_{\struct{B}, \vect{b}{r}}} = n$; moreover, $\struct{B} \models \varphi^n_{\struct{B}, \vect{b}{r}}[\vect{b}{r}]$.}
%%%
\item \emph{Let $\struct{A}$ and $\struct{B}$ be $S$-structures, $\vect{a}{r} \in A$, and $\vect{b}{r} \in B$. Then: $\struct{A} \models \varphi^0_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$ \quad iff \quad $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$.}
%%%
\item \emph{If $\struct{A}$ and $\struct{B}$ are $S$-structures, $\vect{a}{r} \in A$ and $\vect{b}{r} \in B$, and if $\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]$, then $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$.}
%%%
\item \emph{Fixing two $S$-structures $\struct{A}$ and $\struct{B}$, for $n \in \nat$ define
\[
J_n \colonequals \sett{\vect{a}{r} \mapsto \vect{b}{r}}{\(r \in \nat, \vect{a}{r} \in A, \vect{b}{r} \in B\) and \(\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{r}}[\vect{a}{r}]\)}.
\]
Then:
\begin{enumerate}[\rm(i)]
\item $J_n \subset \partism{\struct{A}}{\struct{B}}$;
%%%%
\item $(J_n)_{n \in \nat}$ has the back- and the forth-property;
%%%%
\item If $n > 0$ and $\struct{A} \models \varphi^n_\struct{B}$ then $\emptyset \in J_n$, hence $J_n \neq \emptyset$.
\end{enumerate}}
\end{enumerate}
\begin{proof}
We only prove (III), the others can likewise be proved as their counterparts in text.\\
\ \\
It suffices to show:\smallskip\\
\begin{bquoteno}{62ex}{($++$)}
Let $\vect{a}{r} \in A$, $\vect{b}{r} \in B$. We have: $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$ if and only if for every atomic formula $\varphi \in \fstordlang[r]{S}$ with $\mrk{\varphi} = 0$:\\$\struct{A} \models \varphi[\vect{a}{r}]$ \quad iff \quad $\struct{B} \models \varphi[\vect{b}{r}]$.
\end{bquoteno}\bigskip\\
Notice that every atomic formula $\varphi$ with $\mrk{\varphi} = 0$ must take the form:
\begin{quote}
$v_i \equal v_j$, $c \equal v_j$, $v_j \equal c$, $f\enum[i_1]{v}{i_n} \equal v_j$, $v_j \equal f\enum[i_1]{v}{i_n}$ or $R\enum[i_1]{v}{i_n}$.
\end{quote}
Let $\vect{a}{r} \in A$ and $\vect{b}{r} \in B$. We prove ($++$) as follows:\medskip\\
The direction from left to right: Assume $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$. We verify the claim on the right side for each case of atomic formulas.\medskip\\
For $\varphi = c \equal v_j$ where $0 \leq j < r$, we have\smallskip\\
\begin{tabular}{lll}
\   & $\struct{A} \models c \equal v_j[\vect{a}{r}]$ & \cr
iff & $c^\struct{A} = a_j$ & \cr
iff & $c^\struct{B} = b_j$ & (since $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$) \cr
iff & $\struct{B} \models c \equal v_j[\vect{b}{r}]$. & \cr
\end{tabular}\smallskip\\
For $\varphi = f\enum[i_1]{v}{i_n} \equal v_j$ where $0 \leq \seq[1]{i}{n}, j < r$, we have\smallskip\\
\begin{tabular}{lll}
\   & $\struct{A} \models f\enum[i_1]{v}{i_n} \equal v_j[\vect{a}{r}]$ & \cr
iff & $f^\struct{A}(\seq[i_1]{a}{i_n}) = a_j$ & \cr
iff & $f^\struct{B}(\seq[i_1]{b}{i_n}) = b_j$ & (since $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$) \cr
iff & $\struct{B} \models f\enum[i_1]{v}{i_n} \equal v_j[\vect{b}{r}]$. & \cr
\end{tabular}\smallskip\\
For $\varphi = v_j \equal c$ or $\varphi = v_j \equal f\enum[i_1]{v}{i_n}$, the arguments are symmetrical; for $\varphi = v_i \equal v_j$ or $\varphi = R\enum[i_1]{v}{i_n}$, the claim has already been verified in 1.2(c).\\
\ \\
The direction from right to left: Assume the validity of atomic formulas which have modified quantifier rank $0$ is preserved under $\vect{a}{r} \mapsto \vect{b}{r}$, we need to show $\vect{a}{r} \mapsto \vect{b}{r} \in \partism{\struct{A}}{\struct{B}}$. By the proof of 1.2(c), we only have to check function symbols and constant symbols for $\vect{a}{r} \mapsto \vect{b}{r}$ to be homomorphic:\medskip\\
Let $f \in S$ be an $n$-ary function symbol, and let $0 \leq \seq[1]{i}{n}, j < r$, then\smallskip\\
\begin{tabular}{lll}
\   & $f^\struct{A}(\seq[i_1]{a}{i_n}) = a_j$ & \cr
iff & $\struct{A} \models f\enum[i_1]{v}{i_n} \equal v_j[\vect{a}{r}]$ & \cr
iff & $\struct{B} \models f\enum[i_1]{v}{i_n} \equal v_j[\vect{b}{r}]$ & (by premise) \cr
iff & $f^\struct{B}(\seq[i_1]{b}{i_n}) = b_j$. & \cr
\end{tabular}\smallskip\\
Let $c \in S$ be a constant symbol, and let $0 \leq j < r$, then\smallskip\\
\begin{tabular}{lll}
\   & $c^\struct{A} = a_j$ & \cr
iff & $\struct{A} \models c \equal v_j[\vect{a}{r}]$ & \cr
iff & $\struct{B} \models c \equal v_j[\vect{b}{r}]$ & (by premise) \cr
iff & $c^\struct{B} = b_j$. & \cr
\end{tabular}\medskip\\
Therefore, $\vect{a}{r} \mapsto \vect{b}{r}$ is homomorphic and hence a partial isomorphism from $\struct{A}$ to $\struct{B}$.
\end{proof}
Now we are ready to obtain the converse of (1) (cf.\ the discussion before 3.9). Assume that $\struct{A} \equiv^\prime \struct{B}$. Then for $n > 0$, $\struct{A} \models \varphi^n_\struct{B}$, because $\struct{B} \models \varphi^n_\struct{B}$ by (II); we have $J_n \neq \emptyset$ for $n > 0$ by (V)(iii). Since $(J_n)_{n \in \nat}$ has the forth-property (and the back-property) by (V)(ii), we may apply this to any $p \in J_1$ and any $a \in A$ to obtain a $q \in J_0$; we have $J_0 \neq \emptyset$. Hence $(J_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$. Then we get the converse of (1):\smallskip\\
\begin{quoteno}{(2)}
If $\struct{A} \equiv^\prime \struct{B}$ then $\struct{A} \finiso \struct{B}$.
\end{quoteno}\medskip\\
From the preceding considerations we obtain the following result which is the counterpart of 3.9:\smallskip\\
\emph{Let $S$ be a finite symbol set, and let $\struct{A}$ and $\struct{B}$ be $S$-structures. Then the following are equivalent:\smallskip\\
\emph{\begin{tabular}{ll}
\begin{minipage}{32ex}(a) \emph{$\struct{A} \equiv^\prime \struct{B}$.}\end{minipage} & \begin{minipage}{32ex}(c) \emph{$(J_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$.}\end{minipage} \cr
\begin{minipage}{32ex}(b) \emph{$\struct{A} \models \varphi^n_\struct{B}$ for $n \geq 1$.}\end{minipage} & \begin{minipage}{32ex}(d) \emph{$\struct{A} \finiso \struct{B}$.}\end{minipage}
\end{tabular}}}
\medskip\\
Since $\mrk{\varphi^m_\struct{B}} = m$ for $m \geq 1$, we get the counterpart of 3.10:\smallskip\\
\emph{Let $S$ be a finite symbol set, and let $\struct{A}$ and $\struct{B}$ be $S$-structures. Then the following are equivalent for $m \geq 1$:\smallskip\\
\emph{\begin{tabular}{ll}
\begin{minipage}{32ex}(a) \emph{$\struct{A} \equiv^\prime_m \struct{B}$.}\end{minipage} & \begin{minipage}{32ex}(c) \emph{$(J_n)_{n \leq m}: \struct{A} \iso_m \struct{B}$.}\end{minipage} \cr
\begin{minipage}{32ex}(b) \emph{$\struct{A} \models \varphi^m_\struct{B}$.}\end{minipage} & \begin{minipage}{32ex}(d) \emph{$\struct{A} \iso_m \struct{B}$.}\end{minipage}
\end{tabular}}}
\begin{proof}
The direction from (a) to (b): Let $\struct{A} \equiv^\prime_m \struct{B}$. Since $\struct{B} \models \varphi^m_\struct{B}$ by (II), we have $\struct{A} \models \varphi^m_\struct{B}$ as well.\\
\ \\
The direction from (b) to (c): Let $\struct{A} \models \varphi^m_\struct{B}$. By (V)(iii) we have $J_m \neq \emptyset$; hence, $J_n \neq \emptyset$ for $n \leq m$ by (V)(ii). So by (V)(i) it follows that $(J_n)_{n \leq m}: \struct{A} \iso_m \struct{B}$.\\
\ \\
The direction from (c) to (d): By definition.\\
\ \\
Finally, the direction from (d) to (a): By (1)$^\prime$.
\end{proof}
Recall that in \reftitle{Exercises 3.12} and \reftitle{3.13}, every time we verified statements involving $\qrbase$ or $\Phi_r$ (directly or indirectly) we referred to \reftitle{Theorems 3.2 - 3.10}, namely, \reftitle{Theorems 3.9} and \reftitle{3.10} and the considerations leading to them. Since they remain valid with $\Phi_r$ and $\qrbase$ replaced by ${\Phi_r}^\prime$ and $\mrkbase$, respectively, the claims in \reftitle{Exercises 3.12} and \reftitle{3.13} remain valid as well.\\
\ \\
On the other hand, by replacing all occurrences of $\Phi_r$ and of $\qrbase$ by those of ${\Phi_r}^\prime$ and of $\mrkbase$, respectively, together with suitable replacement of references in the proof given in \reftitle{Exercise 3.14}, we get a proof for the \emph{new version} of \reftitle{Exercise 3.14}. This part of exercise is complete.
%%
\item If $S$ is relational, then every atomic formula must have the form $v_i \equal v_j$ or $R\enum[i_1]{v}{i_n}$.\\
\ \\
Thus, for atomic or negated atomic formulas $\varphi$, $\mrk{\varphi} = 0$. It follows that $\Phi_r = {\Phi_r}^\prime$.\\
\ \\
Next, we prove by induction on $\varphi$ that $\qr{\varphi} = \mrk{\varphi}$ for all $\varphi \in \fstordlang{S}$:\medskip\\
If $\varphi$ is atomic, then by the above argument we have $\qr{\varphi} = 0 = \mrk{\varphi}$, and the claim is true in this case.\smallskip\\
If $\varphi = \neg\psi$, then
\[
\begin{array}{lll}
\ & \qr{\varphi} & \cr
= & \qr{\psi} & \cr
= & \mrk{\psi} & \mbox{(by induction hypothesis)} \cr
= & \mrk{\varphi}. & \cr
\end{array}
\]
If $\varphi = \psi \lor \chi$, then
\[
\begin{array}{lll}
\ & \qr{\varphi} & \cr
= & \max \{ \qr{\psi}, \qr{\chi} \} & \cr
= & \max \{ \mrk{\psi}, \mrk{\chi} \} & \mbox{(by induction hypothesis)} \cr
= & \mrk{\psi\lor\chi}. & \cr
\end{array}
\]
If $\varphi = \exists x \psi$, then
\[
\begin{array}{lll}
\ & \qr{\exists x \psi} & \cr
= & \qr{\psi} + 1 & \cr
= & \mrk{\psi} + 1 & \mbox{(by induction hypothesis)} \cr
= & \mrk{\exists x \psi}. & \cr
\end{array}
\]
\end{enumerate}
\textit{Note.}
\begin{inparaenum}[(1)]
%%
\item In textbook, the equal sign ``$=$'' that appears in the definition of $\mrkbase$ should be replaced by ``$\colonequals$''.\medskip\\
%%
\item We could have proved the statement ($++$) in part (a) otherwise: We only have to consider\smallskip\\
\centerline{$v_i \equal v_j$, $c \equal v_j$, $f\enum[i_1]{v}{i_n} \equal v_j$ or $R\enum[i_1]{v}{i_n}$}\smallskip\\
for $\varphi$, as $v_j \equal c$ and $v_j \equal f\enum[i_1]{v}{i_n}$ are logically equivalent to $c \equal v_j$ and $f\enum[i_i]{v}{i_n} \equal v_j$, respectively. Also note that if $\chi \in \fstordlang{S}$ is in the form of the above formulas then $\relational{\chi}$ is atomic; conversely, if $\chi \in \fstordlang{\relational{S}}$ is atomic then $\invrelational{\chi}$ is in the form of the above formulas. Using the fact that $\partism{\struct{A}}{\struct{B}} = \partism{\relational{\struct{A}}}{\relational{\struct{B}}}$ (cf.\ the discussion after \reftitle{2.4}) and \reftitle{VIII.1.3(a)}, we immediately obtain ($++$) from 1.2(c).
%%
\end{inparaenum}
%
\item \textbf{Solution to Exercise 3.16.} There is a typo in the hint given in part (a): In the definition of $I_n$, the statement ``$\dom{p}$ is finite'' should be replaced by ``$\dom{p}$ contains no more than $m - n + 2$ elements''; moreover, the statement ``both $0$ and $k$ are elements of $\dom{p}$'' should be added to the definition. Namely,
\[
\begin{array}{l}
I_n \colonequals \{ p \in \partism{\struct{A}_k}{\struct{A}_l} \mid \mbox{\(\dom{p}\) contains no more than \(m - n + 2\)} \cr
\phantom{I_n \colonequals \{ }\mbox{\begin{minipage}{\DefaultTabularizedArgumentLength}elements, both \(0\) and \(k\) are elements of \(\dom{p}\), \(p(0) = 0\), \(p(k) = l\), and for all \(a, b \in \dom{p}\), \(d_n(a, b) = d_n(p(a), p(b))\)\}.\end{minipage}}
\end{array}
\]
\begin{enumerate}[(a)]
\item Let $m, k, l \in \nat$ such that $k, l \geq 2^{m + 1}$, and let the distance functions $d_n$ and the sets $I_n$ be defined as in hint. We show that $(I_n)_{n \leq m}: \struct{A}_k \iso_m \struct{A}_l$ below.\medskip\\
First, for $n \leq m$, $I_n \neq \emptyset$ since the map $\{(0, 0), (k, l)\} \in I_n$.\medskip\\
Next, $(I_n)_{n \leq m}$ has the forth-property: Assume $0 \leq a \leq k$ and $p \in I_{n + 1}$, where $n + 1 \leq m$. As in 1.8, we consider the following condition:\smallskip\\\begin{quoteno}{($\ast$)}
There is an $a^\prime \in \dom{p}$ such that $\absval{d_n(a^\prime, a)} < 2^{n + 1}$.
\end{quoteno}\smallskip\\
If the condition ($\ast$) holds for $a^\prime \in \dom{p}$, then we choose \emph{the} $b$ with $0 \leq b \leq l$ and $d_n(a^\prime, a) = d_n(p(a^\prime), b)$ (note that such a $b$ must uniquely exist). It follows that $p \cup \{(a, b)\} \in I_n$. If ($\ast$) does not hold (i.e.\ $d_n(a^\prime, a) = \infty$ for $a^\prime \in \dom{p}$), then we choose an arbitrary $b$ with $0 \leq b \leq l$ and $d_n(p(a^\prime), b) = \infty$ such that $b$ is related to elements in $\rg{p}$ in the ordering $<$ in the same manner as $a$ is related to elements in $\dom{p}$ in the ordering $<$ (such a $b$ must exist because $\absval{p(a_0) - p(a_1)} \geq 2^{n + 2}$ since $\absval{a_0 - a_1} \geq 2^{n + 2}$ and $d_{n + 1}(a_0, a_1) = d_{n + 1}(p(a_0), p(a_1))$, where $a_0, a_1 \in \dom{p}$, $a_0$ is the largest among those in $\dom{p}$ that are $< a$ and $a_1$ is the smallest among those in $\dom{p}$ that are $> a$). It follows that $p \cup \{(a, b)\} \in I_n$.\medskip\\
Finally, $(I_n)_{n \leq m}$ has the back-property: Symmetrical to the above argument.
%%
\item Suppose there were $\varphi \in \fstordlang[0]{S}$ such that\\
\centerline{$\struct{A}_k \models \varphi$ \quad iff \quad $k$ is even.}\\
Let $\qr{\varphi} = m$ and choose $k \geq 2^{m + 1}$. By (a) we would have that $\struct{A}_k \iso_m \struct{A}_{k + 1}$, and hence by 3.3 that $\struct{A}_k \equiv_m \struct{A}_{k + 1}$; therefore,\smallskip\\
\begin{tabular}{lll}
\   & $k$ is even & \cr
iff & $\struct{A}_k \models \varphi$ & (by premise) \cr
iff & $\struct{A}_{k + 1} \models \varphi$ & (since $\struct{A}_k \equiv_m \struct{A}_{k + 1}$) \cr
iff & $k + 1$ is even, & (by premise) \cr
\end{tabular}\smallskip\\
a contradiction.
\begin{remark}
In fact, there is no $\emptyset$-sentence whose finite models are the structures of even cardinalities. Moreover, for any symbol set $S$ the class in which finite models are the structures of even cardinalities is not elementary (cf.\ Example 2.3.6 of \cite{Heinz_Dieter_Ebbinghaus_and_Jorg_Flum}). However, this class is $\Delta$-elementary: Take the set $\setm{\neg\varphi_{=2n+1}}{n \in \nat}$ where $\varphi_{=m}$ formulates the idea that ``there are exactly $m$ elements'' (cf.\ III.6.3).
\end{remark}
\end{enumerate}
%
\item \textbf{Solution to Exercise 3.17.} Fix an $m \geq 1$ and let $\struct{A}$ be an $S$-structure. For $\seq[1]{l}{r} \in \{ 0, 1 \}$ we write $A^{\tuple{\seq[1]{l}{r}}}$ for $\enumpop{A_1^{(l_1)}}{\cap}{A_r^{(l_r)}}$, where
\[
A_i^{(l_i)} \colonequals \begin{cases}
P^A_i             & \mbox{if \(l_i = 0\)} \cr
A \setminus P^A_i & \mbox{othewise}
\end{cases}
\]
for $1 \leq i \leq r$. Likewise define $B^{\tuple{\seq[1]{l}{r}}}$ for the structure $\struct{B}$ introduced below.\\
\ \\
Let $\struct{B}$ be a substructure of $\struct{A}$ such that for all $\seq[1]{l}{r} \in \{ 0, 1 \}$:
\begin{itemize}
\item $B^{\tuple{\seq[1]{l}{r}}} \subset A^{\tuple{\seq[1]{l}{r}}}$;
%%
\item if $A^{\tuple{\seq[1]{l}{r}}}$ contains fewer than $m$ elements, then $B^{\tuple{\seq[1]{l}{r}}} = A^{\tuple{\seq[1]{l}{r}}}$, otherwise $B^{\tuple{\seq[1]{l}{r}}}$ contains exactly $m$ elements from $A^{\tuple{\seq[1]{l}{r}}}$.
\end{itemize}
Obviously $B$ contains at most $m \cdot 2^r$ elements.\\
\ \\
For $\struct{A} \iso_m \struct{B}$ it suffices to show $\struct{A} \models \varphi^m_\struct{B}$ by 3.10. For this purpose we show\smallskip\\
\begin{quoteno}{($\ast$)}
for $n \leq m$, \ if $\vect{a}{m - n} \mapsto \vect{b}{m - n} \in \partism{\struct{A}}{\struct{B}}$ then $\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{m - n}}[\vect{a}{m - n}]$
\end{quoteno}\smallskip\\
by \emph{finite} induction on $n$. Then ($\ast$) together with 3.7 yields\\
\centerline{for $n \leq m$, \quad $\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{m - n}}[\vect{a}{m - n}]$ \quad iff \quad $\vect{a}{m - n} \mapsto \vect{b}{m - n} \in \partism{\struct{A}}{\struct{B}}$.}\\
In particular, $\struct{A} \models \varphi^m_\struct{B}$ since $\emptyset \in \partism{\struct{A}}{\struct{B}}$.\medskip\\
We immediately have ($\ast$) holds for the base case $n = 0$ by 3.6.\medskip\\
For the inductive step, assume $n + 1 \leq m$ and let $p \colonequals \vect{a}{m - n - 1} \mapsto \vect{b}{m - n - 1} \in \partism{\struct{A}}{\struct{B}}$. To obtain $\struct{A} \models \varphi^{n + 1}_{\struct{B}, \vect{b}{m - n - 1}}[\vect{a}{m - n - 1}]$ we have to verify:
\begin{enumerate}[(1)]
\item $\struct{A} \models \forall v_{m - n - 1} \bigvee \setm{\varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}]$.
%%
\item $\struct{A} \models \bigwedge \setm{\exists v_{m - n - 1} \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}]$.
\end{enumerate}
First, for (1) we choose an arbitrary $a \in A$. Then $a \in A^{\tuple{\seq[1]{l}{r}}}$ for some $\seq[1]{l}{r} \in \{ 0, 1 \}$, and
\begin{itemize}
\item if $a \in \dom{p}$, then there is $b^\prime \in \rg{p}$ such that $p(a) = b^\prime$ and hence $\vect{a}{m - n - 1}a \mapsto \vect{b}{m - n - 1}b^\prime = p \in \partism{\struct{A}}{\struct{B}}$. By induction hypothesis, we have $\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b^\prime}[\vect{a}{m - n - 1}a]$. So $\struct{A} \models \bigvee \setm{\varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}a]$;
%%
\item if $a \not\in \dom{p}$, we can choose $b^\prime \in B^{\tuple{\seq[1]{l}{r}}}$ such that $p \cup \{ (a, b^\prime) \} \in \partism{\struct{A}}{\struct{B}}$. In fact, if there are $k$ elements in $\dom{p}$ that are also in $A^{\tuple{\seq[1]{l}{r}}}$, then clearly $k \leq m - n - 1$ or $k + 1 \leq m - n$; moreover, $A^{\tuple{\seq[1]{l}{r}}}$ has at least $k + 1$ elements, and so does $B^{\tuple{\seq[1]{l}{r}}}$. As in the above case, we have 
$\struct{A} \models \bigvee \setm{\varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}a]$.
\end{itemize}
In either case we have $\struct{A} \models \bigvee \setm{\varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}a]$. It follows that $\struct{A} \models \forall v_{m - n - 1} \bigvee \setm{\varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}]$ since $a$ is chosen arbitrarily.\\
\ \\
Next, for (2) we choose an arbitrary $b \in B$. Then $b \in B^{\tuple{\seq[1]{l}{r}}}$ for some $\seq[1]{l}{r} \in \{ 0, 1 \}$, and
\begin{itemize}
\item if $b \in \rg{p}$, then there is $a \in \dom{p}$ such that $p(a) = b$ and hence $\vect{a}{m - n - 1}a \mapsto \vect{b}{m - n - 1}b = p \in \partism{\struct{A}}{\struct{B}}$. By induction hypothesis, we have $\struct{A} \models \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}[\vect{a}{m - n - 1}a]$. So $\struct{A} \models \exists v_{m - n - 1} \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}[\vect{a}{m - n - 1}]$;
%%
\item if $b \not\in \rg{p}$, we can choose $a \in A^{\tuple{\seq[1]{l}{r}}}$ such that $p \cup \{ (a, b) \} \in \partism{\struct{A}}{\struct{B}}$ since $B^{\tuple{\seq[1]{l}{r}}} \subset A^{\tuple{\seq[1]{l}{r}}}$. Similar to the above case, we have 
$\struct{A} \models \exists v_{m - n - 1} \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}[\vect{a}{m - n - 1}]$.
\end{itemize}
In either case we have $\struct{A} \models \exists v_{m - n - 1} \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}[\vect{a}{m - n - 1}]$. It follows that $\struct{A} \models \bigwedge \setm{\exists v_{m - n - 1} \varphi^n_{\struct{B}, \vect{b}{m - n - 1}b}}{b \in B}[\vect{a}{m - n - 1}]$ since $b$ is chosen arbitrarily.
%
\item \textbf{Solution to Exercise 3.18.} (a) Suppose $\varphi$ is satisfiable and let $\struct{A}$ be an $S$-structure that satisfies $\varphi$. By Exercise 3.17, there is a structure $\struct{B}$ with $\struct{A} \iso_m \struct{B}$ containing at most $m \cdot 2^r$ elements. Since $S$ is finite and relational, by 3.10 we have $\struct{A} \equiv_m \struct{B}$. Therefore $\struct{B}$ is also a model of $\varphi$, and the claim is proved.\\
\ \\
(b) The set of unsatisfiable $S$-sentences is R-decidable: If $\psi$ is an $S$-sentence (the set of $S$-sentences is R-decidable, cf.\ part (b) of Exercise X.1.3), then by systematically checking all $S$-structures containing at most $m \cdot 2^r$ elements (cf.\ the argument in the proof of Lemma X.5.2) we can tell whether $\psi$ is unsatisfiable according to part (a).\\
\ \\
Also, for every $\psi \in \fstordlang[0]{S}$:\\
\centerline{$\psi$ is valid \quad iff \quad $\neg\psi$ is unsatisfiable.}\\
Hence, the set $\sett{\psi}{\(\psi \in \fstordlang[0]{S}\), \(\psi\) valid}$ is R-decidable.
\end{enumerate}
%End of Section XII.3-------------------------------------------------------------
\
\\
\\
%Section XII.4--------------------------------------------------------------------
{\large \S4. Ehrenfeucht Games}
\begin{enumerate}[1.]
\item \textbf{Note on the Proof of Lemma 4.1.} (INCOMPLETE: ``II wins this play'') From definition it immediately follows that for $n \in \nat$, $I^\prime_{n + 1} \subset I^\prime_n$. In fact, if $p \in I^\prime_{n + 1}$ then there is $q \in I_{n + 1}$ such that $p \subset q$. By the forth- (or the back-) property there is $q^\prime \in I_n$ with $q \subset q^\prime$. So $p \subset q^\prime$ and hence $p \in I_n^\prime$.\\
\ \\
Now we show that $(I_n^\prime)_{n \in \nat}: \struct{A} \finiso \struct{B}$ provided that $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$. First note that for $n \in \nat$, $I_n \subset \bigcup_{q \in I_n} \powerset{q} = I_n^\prime$ (where $\powerset{q}$ is the power set of $q$) and hence $\emptyset \neq I_n^\prime \subset \partism{\struct{A}}{\struct{B}}$.\medskip\\
Next, $(I_n^\prime)_{n \in \nat}$ has the forth-property: Let $n \in \nat$, $p \in I^\prime_{n + 1}$ and $a \in A$. Then there is $q \in I_{n + 1}$ such that $p \subset q$. By the forth-property of $(I_n)_{n \in \nat}$, there is a $b \in B$ such that $q \cup \{(a, b)\} \in I_n$. We have $p \cup \{(a, b)\} \in I_n^\prime$ since $p \cup \{(a, b)\} \subset q \cup \{(a, b)\}$.\medskip\\
Finally, $(I_n^\prime)_{n \in \nat}$ has the back-property: Analogously.\\
\ \\
On the other hand, the statement ``II has a winning strategy for the game'' in the last line on page 258 should be replaced by ``II wins this play.'' Since we are describing a winning strategy for player II there, the latter phrase is better for an ending statement.\\
\ \\
Here we verify $(I_n)_{n \in \nat}: \struct{A} \finiso \struct{B}$ (with the premise that player II has a winning strategy in $\egame{\struct{A}}{\struct{B}}$) in the latter part of this proof: First note that by definition we have for $n \in \nat$, $\emptyset \in I_n \subset \partism{\struct{A}}{\struct{B}}$.\medskip\\
Next, $(I_n)_{n \in \nat}$ has the forth-property: Let $n \in \nat$, $p \in I_{n + 1}$ and $a \in A$. By definition there are $j \in \nat$ and $\seq[1]{a}{j} \in A$ with $\dom{p} = \{ \seq[1]{a}{j} \}$ such that there is an $m \geq n + 1$ for a $\egame{\struct{A}}{\struct{B}}$-play in which:
\begin{itemize}
\item player I begins by choosing the number $m + j$;
%
\item player II plays according to his winning strategy;
%
\item in the first $j$ moves the elements $\seq[1]{a}{j} \in A$ and $\seqp{p(a_1)}{p(a_j)} \in B$ are chosen.
\end{itemize}
Since player II has a winning strategy, we may assume, without loss of generality, that $a = a_{j + 1}$ is the element that player I chooses in his $(j + 1)$st move in the above play. Let $b \in B$ be the element that player II chooses in his $(j + 1)$st move in responce to player I. Then $p^\prime \colonequals p \cup \{ (a, b) \} \in \partism{\struct{A}}{\struct{B}}$ because $p^\prime \subset q$, where $q$ is the partial isomorphism obtained when this play is completed. From $m - 1 \geq n$ it follows that $p^\prime \in I_n$.\medskip\\
Finally, that $(I_n)_{n \in \nat}$ has the back-property can be verified analogously.
%
\item \textbf{Solution to Exercise 4.3.} The direction from left to right: Let $(I_n)_{n \leq r}: \struct{A} \iso_r \struct{B}$. Then also $(I_n^\prime)_{n \leq r}: \struct{A} \iso_r \struct{B}$ (where $I_n^\prime$ is defined as in the proof of 4.1 in text).\medskip\\
Since $(I_n^\prime)_{n \leq r}$ has the back- and the forth-property, the winning strategy described in the proof of 4.1 is also one for II in the game $\egamep{r}{\struct{A}}{\struct{B}}$ because a $\egamep{r}{\struct{A}}{\struct{B}}$-play is also a $\egame{\struct{A}}{\struct{B}}$-play.\\
\ \\
The direction from right to left: Suppose that player II has a winning strategy in $\egamep{r}{\struct{A}}{\struct{B}}$. For $n \leq r$ let $I_n$ be defined as in the latter part (for showing $\struct{A} \finiso \struct{B}$ with the premise that player II has a winning strategy in $\egame{\struct{A}}{\struct{B}}$) of the proof of 4.1. From the rules of the game we immediately obtain $(I_n)_{n \leq r}: \struct{A} \iso_r \struct{B}$.
\end{enumerate}
%End of Section XII.4-------------------------------------------------------------
%End of Chapter XII---------------------------------------------------------------